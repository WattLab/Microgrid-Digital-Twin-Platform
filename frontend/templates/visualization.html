<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Då¯è§†åŒ– - ç“¦ç‰¹å¾®ç”µç½‘æ•°å­—å­ªç”Ÿä»¿çœŸå¹³å°</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { 
            --primary: #ff6b00; 
            --primary-light: #ff8533;
            --blue: #0066cc; 
            --green: #00a854; 
            --solar: #ff9500; 
            --wind: #00b578; 
            --battery: #1890ff; 
            --load: #ff6b6b; 
            --grid: #722ed1;
            --gold: #c9a86c;
            --gold-light: #e8d5a3;
            --bg-dark: #1a1a2e;
            --bg-nav: #0f0f1a;
        }
        body { font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif; background: #0a0a12; overflow: hidden; }
        
        /* åœºæ™¯åˆ‡æ¢TAB - ç§»åˆ°å†…å®¹åŒºåŸŸ */
        .scene-selector {
            position: fixed;
            top: 84px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 99;
            display: flex;
            gap: 3px;
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.95), rgba(18, 18, 31, 0.98));
            backdrop-filter: blur(20px);
            padding: 8px 10px;
            border-radius: 16px;
            border: 1px solid rgba(201, 168, 108, 0.15);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        .scene-tab { 
            padding: 11px 24px; 
            border: none; 
            border-radius: 12px; 
            background: transparent; 
            color: rgba(255,255,255,0.5); 
            font-size: 13px; 
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.3px;
        }
        .scene-tab::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(201, 168, 108, 0.2), rgba(201, 168, 108, 0.05));
            opacity: 0;
            transition: opacity 0.3s;
            border-radius: 12px;
        }
        .scene-tab:hover { 
            color: rgba(255,255,255,0.9);
        }
        .scene-tab:hover::before {
            opacity: 1;
        }
        .scene-tab.active { 
            background: linear-gradient(135deg, var(--gold) 0%, #b8956a 100%);
            color: #1a1a2e;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(201, 168, 108, 0.35);
        }
        .scene-tab.active::before {
            display: none;
        }
        
        #canvas-container { position: fixed; top: 68px; left: 0; right: 0; bottom: 0; background: linear-gradient(180deg, #0a0a12 0%, #0f0f1a 100%); }
        
        /* æ ‡ç­¾æ ·å¼ - é«˜çº§ç»ç’ƒæ€ */
        .label-container { position: fixed; top: 68px; left: 0; right: 0; bottom: 0; pointer-events: none; overflow: hidden; z-index: 50; }
        .object-label { 
            position: absolute; 
            background: rgba(26, 26, 46, 0.9); 
            backdrop-filter: blur(10px);
            padding: 6px 12px; 
            border-radius: 8px; 
            font-size: 11px; 
            font-weight: 500; 
            color: rgba(255,255,255,0.9); 
            box-shadow: 0 4px 16px rgba(0,0,0,0.3); 
            white-space: nowrap; 
            transform: translate(-50%, -100%); 
            border: 1px solid rgba(201, 168, 108, 0.2);
            border-left: 3px solid var(--gold); 
        }
        .object-label::after { content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); border: 8px solid transparent; border-top-color: rgba(26, 26, 46, 0.9); }
        .object-label.solar { border-left-color: var(--solar); }
        .object-label.wind { border-left-color: var(--wind); }
        .object-label.battery { border-left-color: var(--battery); }
        .object-label.building { border-left-color: #78909c; }
        .object-label.ev { border-left-color: var(--green); }
        .object-label.c3 { border-left-color: var(--gold); }
        
        /* è¯¦æƒ…å¼¹çª— - æ·±è‰²é«˜çº§é£æ ¼ */
        .tooltip { 
            position: fixed; 
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.95), rgba(15, 15, 26, 0.98));
            backdrop-filter: blur(20px);
            border-radius: 16px; 
            padding: 18px; 
            min-width: 280px; 
            box-shadow: 0 12px 40px rgba(0,0,0,0.5); 
            z-index: 200; 
            display: none; 
            border: 1px solid rgba(201, 168, 108, 0.15);
        }
        .tooltip.show { display: block; animation: fadeIn 0.25s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .tooltip-header { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.08); }
        .tooltip-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; background: rgba(201, 168, 108, 0.1); }
        .tooltip-title { font-size: 16px; font-weight: 600; color: #fff; }
        .tooltip-subtitle { font-size: 11px; color: rgba(255,255,255,0.5); }
        .tooltip-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 12px; }
        .tooltip-row span:first-child { color: rgba(255,255,255,0.6); }
        .tooltip-row span:last-child { font-weight: 600; color: #fff; }
        .tooltip-row.highlight span:last-child { color: var(--gold); }
        .tooltip-progress { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 10px; overflow: hidden; }
        .tooltip-progress-fill { height: 100%; border-radius: 3px; }
        
        /* é¢æ¿ - æ·±è‰²ç»ç’ƒæ€ */
        .left-panel, .right-panel { position: fixed; top: 152px; width: 290px; max-height: calc(100vh - 168px); overflow-y: auto; z-index: 100; }
        .left-panel { left: 16px; }
        .right-panel { right: 16px; }
        .left-panel::-webkit-scrollbar, .right-panel::-webkit-scrollbar { width: 4px; }
        .left-panel::-webkit-scrollbar-thumb, .right-panel::-webkit-scrollbar-thumb { background: rgba(201, 168, 108, 0.3); border-radius: 2px; }
        
        .info-card { 
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.85), rgba(15, 15, 26, 0.9));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(201, 168, 108, 0.1); 
            border-radius: 16px; 
            padding: 16px; 
            margin-bottom: 12px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.06); }
        .card-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .card-icon.solar { background: rgba(255,149,0,0.15); }
        .card-icon.wind { background: rgba(0,181,120,0.15); }
        .card-icon.battery { background: rgba(24,144,255,0.15); }
        .card-title { font-size: 14px; font-weight: 600; color: #fff; }
        .card-subtitle { font-size: 10px; color: rgba(255,255,255,0.5); }
        .data-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 12px; color: rgba(255,255,255,0.7); }
        .data-item:last-child { border-bottom: none; }
        .data-value { font-family: 'SF Mono', monospace; font-weight: 600; }
        .data-value.solar { color: var(--solar); }
        .data-value.wind { color: var(--wind); }
        .data-value.battery { color: var(--battery); }
        .data-value.load { color: var(--load); }
        .data-value.grid { color: var(--grid); }
        .progress-bar { height: 6px; background: rgba(255,255,255,0.08); border-radius: 3px; margin-top: 8px; }
        .progress-fill { height: 100%; border-radius: 3px; background: linear-gradient(90deg, var(--battery), #4dabff); }
        .building-list { max-height: 180px; overflow-y: auto; }
        .building-item { display: flex; justify-content: space-between; padding: 6px 0; font-size: 11px; border-bottom: 1px solid rgba(255,255,255,0.04); color: rgba(255,255,255,0.7); }
        .device-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .device-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 10px; padding: 10px; font-size: 10px; color: rgba(255,255,255,0.8); }
        .device-icon { font-size: 22px; margin-bottom: 6px; }
        .device-name { font-weight: 600; margin-bottom: 3px; color: #fff; }
        .ev-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .ev-pile { background: rgba(255,255,255,0.03); border-radius: 8px; padding: 8px; text-align: center; font-size: 10px; border: 1px solid rgba(255,255,255,0.06); color: rgba(255,255,255,0.7); }
        .ev-pile.active { border-color: var(--green); background: rgba(0,168,84,0.1); }
        .ev-pile.v2g { border-color: var(--gold); background: rgba(201, 168, 108,0.1); }
        
        /* åº•éƒ¨çŠ¶æ€æ  - é«˜çº§ç»ç’ƒæ€ */
        .bottom-bar { 
            position: fixed; 
            bottom: 16px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.9), rgba(15, 15, 26, 0.95));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(201, 168, 108, 0.12); 
            border-radius: 16px; 
            padding: 14px 28px; 
            display: flex; 
            gap: 32px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.4); 
            z-index: 100; 
        }
        .bottom-stat { text-align: center; }
        .bottom-stat-value { font-family: 'SF Mono', monospace; font-size: 18px; font-weight: 700; color: #fff; }
        .bottom-stat-label { font-size: 10px; color: rgba(255,255,255,0.5); margin-top: 2px; }
        .scene-content { display: none; }
        .scene-content.active { display: block; }
        .chart-wrap { height: 90px; margin-top: 10px; background: rgba(255,255,255,0.02); border-radius: 10px; padding: 8px; }
        .c3-device-list { max-height: 160px; overflow-y: auto; }
        .c3-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 11px; color: rgba(255,255,255,0.8); }
        .c3-item-name { font-weight: 600; color: #fff; }
        .c3-item-battery { display: flex; align-items: center; gap: 6px; }
        .c3-mini-bar { width: 45px; height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; }
        .c3-mini-fill { height: 100%; border-radius: 3px; }
        .status-badge { padding: 3px 10px; border-radius: 12px; font-size: 10px; font-weight: 500; }
        .status-badge.online { background: rgba(82,196,26,0.15); color: #52c41a; }
        .status-badge.charging { background: rgba(24,144,255,0.15); color: #1890ff; }
        .status-badge.warning { background: rgba(250,173,20,0.15); color: #faad14; }
        
        /* é«˜äº®é‡‘è‰²çŠ¶æ€ */
        .status-badge.premium { background: rgba(201, 168, 108, 0.15); color: var(--gold); }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <div class="logo-icon">W</div>
            <div class="logo-text">ç“¦ç‰¹<span>å¾®ç”µç½‘</span></div>
        </div>
        <ul class="nav-links">
            <li><a href="/">é¦–é¡µ</a></li>
            <li><a href="/dashboard">ä»ªè¡¨ç›˜</a></li>
            <li><a href="/visualization" class="active">3Då¯è§†åŒ–</a></li>
            <li><a href="/storage">å‚¨èƒ½è¯¦æƒ…</a></li>
            <li><a href="/trading">ç”µåŠ›äº¤æ˜“</a></li>
            <li><a href="/agent">ç“¦ç‰¹æ™ºèƒ½ä½“</a></li>
            <li><a href="/opendata">å¼€æºæ•°æ®</a></li>
        </ul>
        <div class="status-indicator">
            <span class="status-dot online"></span>
            <span>ç³»ç»Ÿåœ¨çº¿</span>
        </div>
    </nav>
    
    <!-- åœºæ™¯åˆ‡æ¢å™¨ - ç‹¬ç«‹æµ®åŠ¨ -->
    <div class="scene-selector">
        <button class="scene-tab active" onclick="switchScene('microgrid')">ğŸ­ å·¥å•†ä¸šå¾®ç”µç½‘</button>
        <button class="scene-tab" onclick="switchScene('ev')">ğŸš— V2Gå…‰å‚¨å……</button>
        <button class="scene-tab" onclick="switchScene('c3')">ğŸ“± 3Cäº§å“ç›‘æ§</button>
    </div>
    
    <div id="canvas-container"></div>
    <div class="label-container" id="label-container"></div>
    <div class="tooltip" id="tooltip"></div>
    
    <!-- å¾®ç”µç½‘é¢æ¿ -->
    <div class="scene-content active" id="scene-microgrid">
        <div class="left-panel">
            <div class="info-card">
                <div class="card-header"><div class="card-icon solar">â˜€ï¸</div><div><div class="card-title">åˆ†å¸ƒå¼å…‰ä¼</div><div class="card-subtitle">500kWp</div></div></div>
                <div class="data-item"><span>å®æ—¶åŠŸç‡</span><span class="data-value solar" id="pv-power">0 kW</span></div>
                <div class="data-item"><span>ä»Šæ—¥å‘ç”µ</span><span class="data-value solar">0 kWh</span></div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon wind">ğŸ’¨</div><div><div class="card-title">é£åŠ›å‘ç”µ</div><div class="card-subtitle">150kW x3</div></div></div>
                <div class="data-item"><span>å®æ—¶åŠŸç‡</span><span class="data-value wind" id="wind-power">0 kW</span></div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(120,144,156,0.1)">ğŸ—ï¸</div><div><div class="card-title">å›­åŒºå»ºç­‘</div><div class="card-subtitle">12æ ‹</div></div></div>
                <div class="building-list">
                    <div class="building-item"><span>A1 ç”Ÿäº§è½¦é—´</span><span class="data-value load">85kW</span></div>
                    <div class="building-item"><span>A2 ç”Ÿäº§è½¦é—´</span><span class="data-value load">92kW</span></div>
                    <div class="building-item"><span>B1 ä»“å‚¨ä¸­å¿ƒ</span><span class="data-value load">25kW</span></div>
                    <div class="building-item"><span>B2 ç‰©æµä¸­å¿ƒ</span><span class="data-value load">35kW</span></div>
                    <div class="building-item"><span>C1 ç ”å‘å¤§æ¥¼</span><span class="data-value load">45kW</span></div>
                    <div class="building-item"><span>C2 åŠå…¬å¤§æ¥¼</span><span class="data-value load">38kW</span></div>
                    <div class="building-item"><span>D1 å‘˜å·¥å®¿èˆ</span><span class="data-value load">28kW</span></div>
                    <div class="building-item"><span>D2 é£Ÿå ‚</span><span class="data-value load">42kW</span></div>
                    <div class="building-item"><span>E1 é…ç”µæˆ¿</span><span class="data-value load">5kW</span></div>
                    <div class="building-item"><span>E2 æ°´æ³µæˆ¿</span><span class="data-value load">15kW</span></div>
                    <div class="building-item"><span>F1 é—¨å«å®¤</span><span class="data-value load">2kW</span></div>
                    <div class="building-item"><span>F2 åœè½¦åœº</span><span class="data-value load">8kW</span></div>
                </div>
            </div>
        </div>
        <div class="right-panel">
            <div class="info-card">
                <div class="card-header"><div class="card-icon battery">ğŸ”‹</div><div><div class="card-title">å‚¨èƒ½ç”µç«™</div><div class="card-subtitle">1MWh/500kW</div></div></div>
                <div class="data-item"><span>çŠ¶æ€</span><span class="status-badge charging" id="batt-status">å……ç”µä¸­</span></div>
                <div class="data-item"><span>åŠŸç‡</span><span class="data-value battery" id="batt-power">0 kW</span></div>
                <div class="data-item"><span>SOC</span><span class="data-value battery" id="batt-soc">50%</span></div>
                <div class="progress-bar"><div class="progress-fill" id="batt-bar" style="width:50%"></div></div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(114,46,209,0.1)">âš¡</div><div><div class="card-title">ç”µç½‘äº¤äº’</div></div></div>
                <div class="data-item"><span>äº¤æ¢åŠŸç‡</span><span class="data-value grid" id="grid-power">0 kW</span></div>
                <div class="data-item"><span>å½“å‰ç”µä»·</span><span class="data-value">0.68 å…ƒ</span></div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(255,107,107,0.1)">ğŸ“Š</div><div><div class="card-title">æ€»è´Ÿè·</div></div></div>
                <div class="data-item"><span>å½“å‰</span><span class="data-value load" id="load-power">0 kW</span></div>
                <div class="chart-wrap"><canvas id="power-chart"></canvas></div>
            </div>
        </div>
    </div>
    
    <!-- EVé¢æ¿ -->
    <div class="scene-content" id="scene-ev">
        <div class="left-panel">
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(0,168,84,0.1)">ğŸš—</div><div><div class="card-title">V2Gå…‰å‚¨å……ç«™</div></div></div>
                <div class="data-item"><span>å……ç”µæ¡©</span><span class="data-value">16ä¸ª</span></div>
                <div class="data-item"><span>V2Gæ¡©</span><span class="data-value" style="color:var(--primary)">4ä¸ª</span></div>
                <div class="data-item"><span>åœ¨å……è½¦è¾†</span><span class="data-value" style="color:var(--green)">6è¾†</span></div>
                <div class="data-item"><span>V2Gæ”¾ç”µ</span><span class="data-value" style="color:var(--primary)">2è¾†</span></div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon solar">â˜€ï¸</div><div><div class="card-title">å…‰ä¼è½¦æ£š</div><div class="card-subtitle">200kWp</div></div></div>
                <div class="data-item"><span>å‘ç”µåŠŸç‡</span><span class="data-value solar">85.6 kW</span></div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon battery">ğŸ”‹</div><div><div class="card-title">ç«™å†…å‚¨èƒ½</div><div class="card-subtitle">500kWh</div></div></div>
                <div class="data-item"><span>SOC</span><span class="data-value battery">72%</span></div>
                <div class="progress-bar"><div class="progress-fill" style="width:72%"></div></div>
            </div>
        </div>
        <div class="right-panel">
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(0,168,84,0.1)">âš¡</div><div><div class="card-title">å……ç”µæ¡©çŠ¶æ€</div></div></div>
                <div class="ev-grid">
                    <div class="ev-pile active">ğŸš— 45kW</div><div class="ev-pile active">ğŸš— 60kW</div>
                    <div class="ev-pile v2g">ğŸ”Œ -30kW</div><div class="ev-pile active">ğŸš— 120kW</div>
                    <div class="ev-pile">ğŸ…¿ï¸ ç©ºé—²</div><div class="ev-pile active">ğŸš— 90kW</div>
                    <div class="ev-pile v2g">ğŸ”Œ -25kW</div><div class="ev-pile">ğŸ…¿ï¸ ç©ºé—²</div>
                    <div class="ev-pile active">ğŸš— 75kW</div><div class="ev-pile">ğŸ…¿ï¸ ç©ºé—²</div>
                    <div class="ev-pile active">ğŸš— 60kW</div><div class="ev-pile">ğŸ…¿ï¸ ç©ºé—²</div>
                    <div class="ev-pile">ğŸ…¿ï¸ ç©ºé—²</div><div class="ev-pile">ğŸ…¿ï¸ ç©ºé—²</div>
                    <div class="ev-pile">ğŸ…¿ï¸ ç©ºé—²</div><div class="ev-pile">ğŸ…¿ï¸ ç©ºé—²</div>
                </div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(255,107,0,0.1)">ğŸ’°</div><div><div class="card-title">è¿è¥ç»Ÿè®¡</div></div></div>
                <div class="data-item"><span>ä»Šæ—¥å……ç”µé‡</span><span class="data-value" style="color:var(--green)">1,850 kWh</span></div>
                <div class="data-item"><span>V2Gæ”¾ç”µé‡</span><span class="data-value" style="color:var(--primary)">320 kWh</span></div>
                <div class="data-item"><span>ä»Šæ—¥æ”¶å…¥</span><span class="data-value" style="color:var(--green)">Â¥2,450</span></div>
            </div>
        </div>
    </div>
    
    <!-- 3Cé¢æ¿ -->
    <div class="scene-content" id="scene-c3">
        <div class="left-panel">
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(0,102,204,0.1)">ğŸ“±</div><div><div class="card-title">è®¾å¤‡ç›‘æ§</div><div class="card-subtitle">24å°è®¾å¤‡</div></div></div>
                <div class="data-item"><span>åœ¨çº¿</span><span class="data-value" style="color:var(--green)">22å°</span></div>
                <div class="data-item"><span>å……ç”µä¸­</span><span class="data-value battery">8å°</span></div>
                <div class="data-item"><span>ä½ç”µé‡</span><span class="data-value" style="color:#ff4d4f">3å°</span></div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(82,196,26,0.1)">ğŸ“Š</div><div><div class="card-title">è®¾å¤‡åˆ†å¸ƒ</div></div></div>
                <div class="device-grid">
                    <div class="device-card"><div class="device-icon">ğŸ“±</div><div class="device-name">æ‰‹æœº</div><div>8å°</div></div>
                    <div class="device-card"><div class="device-icon">ğŸ“Ÿ</div><div class="device-name">å¹³æ¿</div><div>6å°</div></div>
                    <div class="device-card"><div class="device-icon">ğŸ’»</div><div class="device-name">ç¬”è®°æœ¬</div><div>5å°</div></div>
                    <div class="device-card"><div class="device-icon">âŒš</div><div class="device-name">æ‰‹è¡¨</div><div>5å°</div></div>
                </div>
            </div>
        </div>
        <div class="right-panel">
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(0,102,204,0.1)">ğŸ“±</div><div><div class="card-title">æ‰‹æœºçŠ¶æ€</div></div></div>
                <div class="c3-device-list" id="phone-list"></div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(114,46,209,0.1)">ğŸ“Ÿ</div><div><div class="card-title">å¹³æ¿çŠ¶æ€</div></div></div>
                <div class="c3-device-list" id="tablet-list"></div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(24,144,255,0.1)">ğŸ’»</div><div><div class="card-title">ç¬”è®°æœ¬çŠ¶æ€</div></div></div>
                <div class="c3-device-list" id="laptop-list"></div>
            </div>
            <div class="info-card">
                <div class="card-header"><div class="card-icon" style="background:rgba(250,140,22,0.1)">âŒš</div><div><div class="card-title">æ‰‹è¡¨çŠ¶æ€</div></div></div>
                <div class="c3-device-list" id="watch-list"></div>
            </div>
        </div>
    </div>
    
    <div class="bottom-bar">
        <div class="bottom-stat"><div class="bottom-stat-value" style="color:var(--solar)" id="stat-solar">0</div><div class="bottom-stat-label">å…‰ä¼ kW</div></div>
        <div class="bottom-stat"><div class="bottom-stat-value" style="color:var(--wind)" id="stat-wind">0</div><div class="bottom-stat-label">é£ç”µ kW</div></div>
        <div class="bottom-stat"><div class="bottom-stat-value" style="color:var(--battery)" id="stat-soc">50</div><div class="bottom-stat-label">å‚¨èƒ½ %</div></div>
        <div class="bottom-stat"><div class="bottom-stat-value" style="color:var(--load)" id="stat-load">0</div><div class="bottom-stat-label">è´Ÿè· kW</div></div>
        <div class="bottom-stat"><div class="bottom-stat-value" style="color:var(--grid)" id="stat-grid">0</div><div class="bottom-stat-label">ç”µç½‘ kW</div></div>
    </div>

    <script>
        let scene, camera, renderer, controls, windBlades = [], sceneObjects = [], currentScene = 'microgrid';
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let hoveredObject = null;
        
        // å¯¹è±¡æ•°æ®
        const objectData = {
            // å¾®ç”µç½‘
            'A1ç”Ÿäº§è½¦é—´': { type: 'building', icon: 'ğŸ­', power: 85, area: 1200, floors: 2, workers: 120, desc: 'ä¸»è¦ç”Ÿäº§è½¦é—´ï¼Œé…å¤‡è‡ªåŠ¨åŒ–ç”Ÿäº§çº¿' },
            'A2ç”Ÿäº§è½¦é—´': { type: 'building', icon: 'ğŸ­', power: 92, area: 1100, floors: 2, workers: 100, desc: 'è¾…åŠ©ç”Ÿäº§è½¦é—´ï¼Œç²¾å¯†åŠ å·¥åŒº' },
            'B1ä»“å‚¨ä¸­å¿ƒ': { type: 'building', icon: 'ğŸ“¦', power: 25, area: 2000, floors: 1, capacity: '5000ã¡', desc: 'åŸææ–™åŠæˆå“ä»“å‚¨åŒº' },
            'B2ç‰©æµä¸­å¿ƒ': { type: 'building', icon: 'ğŸš›', power: 35, area: 1500, floors: 1, docks: 8, desc: 'ç‰©æµåˆ†æ‹¨ä¸­å¿ƒï¼Œ8ä¸ªè£…å¸å£' },
            'C1ç ”å‘å¤§æ¥¼': { type: 'building', icon: 'ğŸ”¬', power: 45, area: 800, floors: 5, labs: 12, desc: 'ç ”å‘ä¸­å¿ƒï¼Œå«12ä¸ªå®éªŒå®¤' },
            'C2åŠå…¬å¤§æ¥¼': { type: 'building', icon: 'ğŸ¢', power: 38, area: 600, floors: 4, offices: 50, desc: 'è¡Œæ”¿åŠå…¬åŒºåŸŸ' },
            'D1å‘˜å·¥å®¿èˆ': { type: 'building', icon: 'ğŸ ', power: 28, area: 1000, floors: 6, rooms: 120, desc: 'å‘˜å·¥ä½å®¿åŒº' },
            'D2é£Ÿå ‚': { type: 'building', icon: 'ğŸ½ï¸', power: 42, area: 500, floors: 2, seats: 500, desc: 'å‘˜å·¥é¤å…ï¼Œå¯å®¹çº³500äºº' },
            'E1é…ç”µæˆ¿': { type: 'building', icon: 'âš¡', power: 5, voltage: '10kV', capacity: '2000kVA', desc: 'å›­åŒºé…ç”µä¸­å¿ƒ' },
            'E2æ°´æ³µæˆ¿': { type: 'building', icon: 'ğŸ’§', power: 15, pumps: 4, flow: '200mÂ³/h', desc: 'ä¾›æ°´æ³µç«™' },
            'F1é—¨å«å®¤': { type: 'building', icon: 'ğŸš§', power: 2, guards: 4, desc: 'å›­åŒºä¸»å…¥å£å®‰ä¿' },
            'F2åœè½¦åœº': { type: 'building', icon: 'ğŸ…¿ï¸', power: 8, spots: 200, evSpots: 20, desc: 'å‘˜å·¥åœè½¦åœºï¼Œå«20ä¸ªå……ç”µä½' },
            'å…‰ä¼é˜µåˆ—A': { type: 'solar', icon: 'â˜€ï¸', capacity: 200, todayGen: 860, efficiency: 18.5, panels: 500, desc: 'AåŒºå±‹é¡¶å…‰ä¼' },
            'å…‰ä¼é˜µåˆ—B': { type: 'solar', icon: 'â˜€ï¸', capacity: 200, todayGen: 820, efficiency: 18.2, panels: 500, desc: 'BåŒºå±‹é¡¶å…‰ä¼' },
            'åœ°é¢å…‰ä¼': { type: 'solar', icon: 'â˜€ï¸', capacity: 100, todayGen: 420, efficiency: 19.0, panels: 250, desc: 'åœ°é¢é›†ä¸­å¼å…‰ä¼' },
            'é£æœº1': { type: 'wind', icon: 'ğŸ’¨', capacity: 50, todayGen: 280, windSpeed: 5.2, rpm: 15, desc: '1å·é£åŠ›å‘ç”µæœº' },
            'é£æœº2': { type: 'wind', icon: 'ğŸ’¨', capacity: 50, todayGen: 265, windSpeed: 4.8, rpm: 14, desc: '2å·é£åŠ›å‘ç”µæœº' },
            'é£æœº3': { type: 'wind', icon: 'ğŸ’¨', capacity: 50, todayGen: 290, windSpeed: 5.5, rpm: 16, desc: '3å·é£åŠ›å‘ç”µæœº' },
            'å‚¨èƒ½ç”µç«™': { type: 'battery', icon: 'ğŸ”‹', capacity: 1000, power: 500, soc: 65, cycles: 1250, desc: 'ç£·é…¸é“é”‚å‚¨èƒ½ç³»ç»Ÿ' },
            'å˜ç”µç«™': { type: 'grid', icon: 'âš¡', voltage: '10kV', capacity: 2000, desc: 'å›­åŒºæ€»å˜ç”µç«™' },
            'æ²³æµ': { type: 'nature', icon: 'ğŸŒŠ', length: 500, width: 15, desc: 'å›­åŒºæ™¯è§‚æ²³æµ' },
            'å°æ¡¥': { type: 'nature', icon: 'ğŸŒ‰', length: 15, material: 'æœ¨è´¨', desc: 'æ™¯è§‚æ­¥è¡Œæ¡¥' },
            // EVåœºæ™¯
            'å…‰ä¼è½¦æ£šA': { type: 'solar', icon: 'â˜€ï¸', capacity: 50, spots: 20, desc: 'AåŒºå…‰ä¼è½¦æ£š' },
            'å…‰ä¼è½¦æ£šB': { type: 'solar', icon: 'â˜€ï¸', capacity: 50, spots: 20, desc: 'BåŒºå…‰ä¼è½¦æ£š' },
            'å…‰ä¼è½¦æ£šC': { type: 'solar', icon: 'â˜€ï¸', capacity: 50, spots: 20, desc: 'CåŒºå…‰ä¼è½¦æ£š' },
            'å…‰ä¼è½¦æ£šD': { type: 'solar', icon: 'â˜€ï¸', capacity: 50, spots: 20, desc: 'DåŒºå…‰ä¼è½¦æ£š' },
            'å‚¨èƒ½æŸœ': { type: 'battery', icon: 'ğŸ”‹', capacity: 500, power: 250, soc: 72, desc: 'ç«™å†…å‚¨èƒ½ç³»ç»Ÿ' },
            'æœåŠ¡ä¸­å¿ƒ': { type: 'building', icon: 'ğŸª', area: 150, services: 'ä¼‘æ¯ã€ä¾¿åˆ©åº—', desc: 'å……ç”µç«™æœåŠ¡ä¸­å¿ƒ' },
            'V2Gæ ‡è¯†A': { type: 'ev', icon: 'ğŸ”Œ', v2gPiles: 2, power: '60kW', desc: 'AåŒºV2Gå……ç”µåŒº' },
            'V2Gæ ‡è¯†B': { type: 'ev', icon: 'ğŸ”Œ', v2gPiles: 2, power: '60kW', desc: 'BåŒºV2Gå……ç”µåŒº' },
            // 3Cåœºæ™¯
            'æ‰‹æœºå±•ç¤ºåŒº': { type: 'c3', icon: 'ğŸ“±', devices: 8, charging: 2, desc: 'åä¸ºæ‰‹æœºæ——èˆ°å±•ç¤ºåŒºï¼Œå±•ç¤ºMate/Pç³»åˆ—' },
            'å¹³æ¿å±•ç¤ºåŒº': { type: 'c3', icon: 'ğŸ“Ÿ', devices: 6, charging: 2, desc: 'MatePadç³»åˆ—å¹³æ¿ä½“éªŒåŒº' },
            'ç¬”è®°æœ¬å±•ç¤ºåŒº': { type: 'c3', icon: 'ğŸ’»', devices: 5, charging: 1, desc: 'MateBookç³»åˆ—ç¬”è®°æœ¬å±•ç¤º' },
            'æ™ºèƒ½ç©¿æˆ´åŒº': { type: 'c3', icon: 'âŒš', devices: 5, charging: 1, desc: 'WATCH/FreeBudsç³»åˆ—ç©¿æˆ´è®¾å¤‡' },
            'æ™ºèƒ½å®¶å±…åŒº': { type: 'c3', icon: 'ğŸ ', devices: 4, products: 'éŸ³ç®±/å°ç¯/è·¯ç”±å™¨', desc: 'å…¨å±‹æ™ºèƒ½ç”Ÿæ€å±•ç¤ºåŒº' },
            'é…ä»¶å±•ç¤ºå¢™': { type: 'c3', icon: 'ğŸ§', items: 24, categories: 'è€³æœº/å……ç”µå™¨/ä¿æŠ¤å£³', desc: 'åŸè£…é…ä»¶å±•ç¤ºé”€å”®åŒº' },
            'ä½“éªŒä¼‘æ¯åŒº': { type: 'c3', icon: 'ğŸ›‹ï¸', seats: 4, desc: 'é¡¾å®¢ä¼‘æ¯ç­‰å€™åŒºåŸŸ' },
            'æœåŠ¡å°': { type: 'c3', icon: 'ğŸ’', services: 'å’¨è¯¢/å”®å/ç»´ä¿®', desc: 'å®¢æˆ·æœåŠ¡ä¸­å¿ƒ' },
            'å“ç‰Œå±•ç¤ºå±': { type: 'c3', icon: 'ğŸ–¥ï¸', size: '98å¯¸', resolution: '4K', desc: 'å“ç‰Œå®£ä¼ ä¸äº§å“å±•ç¤ºå¤§å±' }
        };
        
        // 3Cè®¾å¤‡æ•°æ®
        const c3Devices = {
            phones: [
                { name: 'iPhone 15 Pro', battery: 85, health: 98, status: 'ä½¿ç”¨ä¸­' },
                { name: 'iPhone 14', battery: 45, health: 95, status: 'å……ç”µä¸­' },
                { name: 'Huawei Mate60', battery: 72, health: 99, status: 'å¾…æœº' },
                { name: 'Samsung S24', battery: 18, health: 92, status: 'ä½ç”µé‡' },
                { name: 'Xiaomi 14', battery: 95, health: 100, status: 'ä½¿ç”¨ä¸­' },
                { name: 'OPPO Find X7', battery: 60, health: 96, status: 'å¾…æœº' },
                { name: 'vivo X100', battery: 33, health: 94, status: 'å……ç”µä¸­' },
                { name: 'OnePlus 12', battery: 88, health: 97, status: 'ä½¿ç”¨ä¸­' }
            ],
            tablets: [
                { name: 'iPad Pro', battery: 78, health: 96, status: 'ä½¿ç”¨ä¸­' },
                { name: 'iPad Air', battery: 52, health: 98, status: 'å……ç”µä¸­' },
                { name: 'MatePad Pro', battery: 91, health: 99, status: 'å¾…æœº' },
                { name: 'Galaxy Tab S9', battery: 15, health: 90, status: 'ä½ç”µé‡' },
                { name: 'Xiaomi Pad 6', battery: 68, health: 97, status: 'ä½¿ç”¨ä¸­' },
                { name: 'Surface Pro', battery: 82, health: 95, status: 'å¾…æœº' }
            ],
            laptops: [
                { name: 'MacBook Pro', battery: 72, health: 94, status: 'ä½¿ç”¨ä¸­' },
                { name: 'ThinkPad X1', battery: 88, health: 96, status: 'å……ç”µä¸­' },
                { name: 'Dell XPS 15', battery: 45, health: 92, status: 'ä½¿ç”¨ä¸­' },
                { name: 'HP Spectre', battery: 12, health: 88, status: 'ä½ç”µé‡' },
                { name: 'ASUS ROG', battery: 95, health: 99, status: 'å¾…æœº' }
            ],
            watches: [
                { name: 'Apple Watch', battery: 65, health: 100, status: 'ä½©æˆ´ä¸­' },
                { name: 'Galaxy Watch', battery: 42, health: 98, status: 'å……ç”µä¸­' },
                { name: 'Huawei GT4', battery: 88, health: 99, status: 'ä½©æˆ´ä¸­' },
                { name: 'Xiaomi Watch', battery: 25, health: 95, status: 'å¾…æœº' },
                { name: 'Garmin Fenix', battery: 92, health: 97, status: 'ä½©æˆ´ä¸­' }
            ]
        };
        
        function init3D() {
            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xe8f4fc);
            scene.fog = new THREE.Fog(0xe8f4fc, 150, 500);
            
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(100, 70, 120);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight - 60);
            renderer.shadowMap.enabled = true;
            container.appendChild(renderer.domElement);
            
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.maxPolarAngle = Math.PI / 2.2;
            
            setupLights();
            createMicrogridScene();
            animate();
            
            // é¼ æ ‡äº‹ä»¶
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('click', onMouseClick);
            window.addEventListener('resize', onResize);
        }
        
        function setupLights() {
            scene.add(new THREE.AmbientLight(0xffffff, 0.7));
            const sun = new THREE.DirectionalLight(0xffffff, 1.2);
            sun.position.set(80, 120, 60);
            sun.castShadow = true;
            sun.shadow.mapSize.width = 2048;
            sun.shadow.mapSize.height = 2048;
            scene.add(sun);
            scene.add(new THREE.HemisphereLight(0x87ceeb, 0x7cb342, 0.4));
        }
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            windBlades.forEach(b => { if(b) b.rotation.z += 0.015; });
            updateLabels();
            renderer.render(scene, camera);
        }
        
        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight - 60);
        }
        
        function onMouseMove(e) {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -((e.clientY - 60) / (window.innerHeight - 60)) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(sceneObjects, true);
            
            const tooltip = document.getElementById('tooltip');
            
            if(intersects.length > 0) {
                let obj = intersects[0].object;
                while(obj.parent && !obj.userData.name) obj = obj.parent;
                
                if(obj.userData.name && obj !== hoveredObject) {
                    hoveredObject = obj;
                    showTooltip(obj.userData.name, e.clientX, e.clientY);
                    renderer.domElement.style.cursor = 'pointer';
                }
            } else {
                hoveredObject = null;
                tooltip.classList.remove('show');
                renderer.domElement.style.cursor = 'default';
            }
        }
        
        function onMouseClick(e) {
            if(hoveredObject && hoveredObject.userData.name) {
                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç‚¹å‡»åçš„è¯¦ç»†é¡µé¢è·³è½¬
                console.log('Clicked:', hoveredObject.userData.name);
            }
        }
        
        function showTooltip(name, x, y) {
            const tooltip = document.getElementById('tooltip');
            const data = objectData[name];
            if(!data) return;
            
            let content = `<div class="tooltip-header">
                <div class="tooltip-icon" style="background:${getTypeColor(data.type)}20">${data.icon}</div>
                <div><div class="tooltip-title">${name}</div><div class="tooltip-subtitle">${data.desc || ''}</div></div>
            </div>`;
            
            if(data.type === 'building') {
                content += `<div class="tooltip-row"><span>å½“å‰åŠŸè€—</span><span style="color:var(--load)">${data.power} kW</span></div>`;
                if(data.area) content += `<div class="tooltip-row"><span>å»ºç­‘é¢ç§¯</span><span>${data.area} mÂ²</span></div>`;
                if(data.floors) content += `<div class="tooltip-row"><span>æ¥¼å±‚æ•°</span><span>${data.floors} å±‚</span></div>`;
                if(data.workers) content += `<div class="tooltip-row"><span>å·¥ä½œäººå‘˜</span><span>${data.workers} äºº</span></div>`;
                if(data.capacity) content += `<div class="tooltip-row"><span>å®¹é‡</span><span>${data.capacity}</span></div>`;
            } else if(data.type === 'solar') {
                content += `<div class="tooltip-row highlight"><span>è£…æœºå®¹é‡</span><span>${data.capacity} kWp</span></div>`;
                if(data.todayGen) content += `<div class="tooltip-row"><span>ä»Šæ—¥å‘ç”µ</span><span style="color:var(--solar)">${data.todayGen} kWh</span></div>`;
                if(data.efficiency) content += `<div class="tooltip-row"><span>è½¬æ¢æ•ˆç‡</span><span>${data.efficiency}%</span></div>`;
                if(data.panels) content += `<div class="tooltip-row"><span>ç»„ä»¶æ•°é‡</span><span>${data.panels} å—</span></div>`;
            } else if(data.type === 'wind') {
                content += `<div class="tooltip-row highlight"><span>é¢å®šåŠŸç‡</span><span>${data.capacity} kW</span></div>`;
                if(data.todayGen) content += `<div class="tooltip-row"><span>ä»Šæ—¥å‘ç”µ</span><span style="color:var(--wind)">${data.todayGen} kWh</span></div>`;
                if(data.windSpeed) content += `<div class="tooltip-row"><span>å½“å‰é£é€Ÿ</span><span>${data.windSpeed} m/s</span></div>`;
                if(data.rpm) content += `<div class="tooltip-row"><span>è½¬é€Ÿ</span><span>${data.rpm} rpm</span></div>`;
            } else if(data.type === 'battery') {
                content += `<div class="tooltip-row highlight"><span>å®¹é‡/åŠŸç‡</span><span>${data.capacity}kWh/${data.power}kW</span></div>`;
                content += `<div class="tooltip-row"><span>SOC</span><span style="color:var(--battery)">${data.soc}%</span></div>`;
                content += `<div class="tooltip-progress"><div class="tooltip-progress-fill" style="width:${data.soc}%;background:var(--battery)"></div></div>`;
                if(data.cycles) content += `<div class="tooltip-row"><span>å¾ªç¯æ¬¡æ•°</span><span>${data.cycles} æ¬¡</span></div>`;
            } else if(data.type === 'ev') {
                content += `<div class="tooltip-row highlight"><span>V2Gæ¡©æ•°</span><span>${data.v2gPiles} ä¸ª</span></div>`;
                content += `<div class="tooltip-row"><span>å•æ¡©åŠŸç‡</span><span>${data.power}</span></div>`;
            } else if(data.type === 'c3') {
                content += `<div class="tooltip-row"><span>è®¾å¤‡æ•°é‡</span><span>${data.devices} å°</span></div>`;
                content += `<div class="tooltip-row"><span>å……ç”µä¸­</span><span style="color:var(--battery)">${data.charging} å°</span></div>`;
            }
            
            tooltip.innerHTML = content;
            tooltip.style.left = Math.min(x + 15, window.innerWidth - 280) + 'px';
            tooltip.style.top = Math.min(y + 15, window.innerHeight - 200) + 'px';
            tooltip.classList.add('show');
        }
        
        function getTypeColor(type) {
            const colors = { building: '#78909c', solar: '#ff9500', wind: '#00b578', battery: '#1890ff', grid: '#722ed1', ev: '#00a854', c3: '#0066cc', nature: '#4fc3f7' };
            return colors[type] || '#666';
        }
        
        function updateLabels() {
            const container = document.getElementById('label-container');
            container.innerHTML = '';
            
            sceneObjects.forEach(obj => {
                if(obj.userData.name && obj.userData.labelOffset) {
                    const pos = new THREE.Vector3();
                    obj.getWorldPosition(pos);
                    pos.y += obj.userData.labelOffset;
                    
                    const screenPos = pos.clone().project(camera);
                    const x = (screenPos.x * 0.5 + 0.5) * window.innerWidth;
                    const y = (1 - (screenPos.y * 0.5 + 0.5)) * (window.innerHeight - 60);
                    
                    if(screenPos.z < 1 && x > 0 && x < window.innerWidth && y > 0 && y < window.innerHeight - 60) {
                        const label = document.createElement('div');
                        label.className = 'object-label ' + (obj.userData.labelType || '');
                        label.textContent = obj.userData.name;
                        label.style.left = x + 'px';
                        label.style.top = y + 'px';
                        container.appendChild(label);
                    }
                }
            });
        }
        
        function switchScene(name) {
            currentScene = name;
            document.querySelectorAll('.scene-tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.querySelectorAll('.scene-content').forEach(c => c.classList.remove('active'));
            document.getElementById('scene-' + name).classList.add('active');
            
            while(scene.children.length > 0) scene.remove(scene.children[0]);
            sceneObjects = [];
            windBlades = [];
            setupLights();
            
            if(name === 'microgrid') { createMicrogridScene(); camera.position.set(100, 70, 120); }
            else if(name === 'ev') { createEVScene(); camera.position.set(70, 45, 90); }
            else if(name === 'c3') { createC3Scene(); camera.position.set(90, 55, 100); }
            controls.target.set(0, 0, 0);
        }
        
        // åˆ›å»ºå¸¦æ ‡ç­¾çš„å»ºç­‘
        function createBuilding(x, z, w, h, d, color, name) {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), new THREE.MeshStandardMaterial({ color }));
            body.position.y = h / 2;
            body.castShadow = true;
            group.add(body);
            
            // çª—æˆ·
            const winMat = new THREE.MeshStandardMaterial({ color: 0x87ceeb, metalness: 0.7 });
            const floors = Math.floor(h / 4);
            const winsPerFloor = Math.floor(w / 5);
            for(let f = 0; f < floors; f++) {
                for(let wi = 0; wi < winsPerFloor; wi++) {
                    const win = new THREE.Mesh(new THREE.PlaneGeometry(1.5, 2), winMat);
                    win.position.set(-w/2 + 2.5 + wi * 5, 2 + f * 4, d/2 + 0.05);
                    group.add(win);
                }
            }
            
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: h + 3, labelType: 'building' };
            scene.add(group);
            sceneObjects.push(group);
            return group;
        }
        
        function createMicrogridScene() {
            // åœ°é¢
            const ground = new THREE.Mesh(new THREE.PlaneGeometry(350, 350), new THREE.MeshStandardMaterial({ color: 0x7cb342 }));
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // å±±ä¸˜
            const hillMat = new THREE.MeshStandardMaterial({ color: 0x5d9e3c });
            [[-130, -90, 2, 0.7], [140, -110, 1.5, 0.5], [-110, 110, 1.6, 0.5]].forEach(([x, z, sx, sy]) => {
                const hill = new THREE.Mesh(new THREE.SphereGeometry(25, 12, 12, 0, Math.PI * 2, 0, Math.PI / 2), hillMat);
                hill.position.set(x, 0, z);
                hill.scale.set(sx, sy, 1.2);
                scene.add(hill);
            });
            
            // æ²³æµ
            const riverShape = new THREE.Shape();
            riverShape.moveTo(-175, 70); riverShape.bezierCurveTo(-100, 85, 0, 75, 100, 85); riverShape.lineTo(100, 100); riverShape.bezierCurveTo(0, 90, -100, 100, -175, 85);
            const river = new THREE.Mesh(new THREE.ShapeGeometry(riverShape), new THREE.MeshStandardMaterial({ color: 0x4fc3f7, transparent: true, opacity: 0.8 }));
            river.rotation.x = -Math.PI / 2;
            river.position.y = 0.1;
            river.userData = { name: 'æ²³æµ', labelOffset: 2, labelType: '' };
            scene.add(river);
            sceneObjects.push(river);
            
            // æ¡¥
            const bridge = new THREE.Mesh(new THREE.BoxGeometry(12, 1, 6), new THREE.MeshStandardMaterial({ color: 0x8d6e63 }));
            bridge.position.set(0, 1, 85);
            bridge.userData = { name: 'å°æ¡¥', labelOffset: 3, labelType: '' };
            scene.add(bridge);
            sceneObjects.push(bridge);
            
            // é“è·¯
            const roadMat = new THREE.MeshStandardMaterial({ color: 0x424242 });
            const road1 = new THREE.Mesh(new THREE.PlaneGeometry(10, 180), roadMat);
            road1.rotation.x = -Math.PI / 2; road1.position.set(0, 0.05, -10);
            scene.add(road1);
            const road2 = new THREE.Mesh(new THREE.PlaneGeometry(180, 8), roadMat);
            road2.rotation.x = -Math.PI / 2; road2.position.set(0, 0.05, -10);
            scene.add(road2);
            
            // å»ºç­‘ç‰© (12æ ‹)
            createBuilding(-55, -35, 38, 16, 28, 0xe8e8e8, 'A1ç”Ÿäº§è½¦é—´');
            createBuilding(-55, 15, 38, 16, 28, 0xe8e8e8, 'A2ç”Ÿäº§è½¦é—´');
            createBuilding(-5, -55, 28, 10, 45, 0xf0f0f0, 'B1ä»“å‚¨ä¸­å¿ƒ');
            createBuilding(35, -55, 28, 10, 38, 0xf0f0f0, 'B2ç‰©æµä¸­å¿ƒ');
            createBuilding(55, -18, 18, 26, 18, 0xfafafa, 'C1ç ”å‘å¤§æ¥¼');
            createBuilding(55, 18, 18, 22, 16, 0xfafafa, 'C2åŠå…¬å¤§æ¥¼');
            createBuilding(38, 55, 24, 14, 32, 0xf5f5f5, 'D1å‘˜å·¥å®¿èˆ');
            createBuilding(-18, 55, 18, 9, 22, 0xfffaf0, 'D2é£Ÿå ‚');
            createBuilding(-75, -65, 7, 4, 7, 0xd0d0d0, 'E1é…ç”µæˆ¿');
            createBuilding(-75, -52, 5, 3, 5, 0xc0c0c0, 'E2æ°´æ³µæˆ¿');
            createBuilding(-85, 0, 4, 3, 4, 0xffffff, 'F1é—¨å«å®¤');
            createBuilding(75, 55, 32, 3, 22, 0x606060, 'F2åœè½¦åœº');
            
            // å…‰ä¼
            createPVArray(-55, 17, -35, 30, 22, 'å…‰ä¼é˜µåˆ—A');
            createPVArray(-55, 17, 15, 30, 22, 'å…‰ä¼é˜µåˆ—B');
            createGroundPV(-95, 35, 'åœ°é¢å…‰ä¼');
            
            // é£æœº
            createWindTurbine(95, -45, 'é£æœº1');
            createWindTurbine(105, -15, 'é£æœº2');
            createWindTurbine(95, 15, 'é£æœº3');
            
            // å‚¨èƒ½
            createStorage(-45, -75, 'å‚¨èƒ½ç”µç«™');
            
            // å˜ç”µç«™
            createSubstation(-65, -75, 'å˜ç”µç«™');
            
            // æ ‘æœ¨
            for(let i = 0; i < 40; i++) {
                const x = (Math.random() - 0.5) * 300;
                const z = (Math.random() - 0.5) * 300;
                if(Math.abs(x) > 90 || Math.abs(z) > 70) createTree(x, z);
            }
        }
        
        function createPVArray(x, y, z, w, d, name) {
            const group = new THREE.Group();
            const pvMat = new THREE.MeshStandardMaterial({ color: 0x1a237e, metalness: 0.6 });
            const rows = Math.floor(d / 3), cols = Math.floor(w / 4);
            for(let r = 0; r < rows; r++) {
                for(let c = 0; c < cols; c++) {
                    const panel = new THREE.Mesh(new THREE.BoxGeometry(3.5, 0.06, 1.8), pvMat);
                    panel.position.set(-w/2 + 2 + c * 4, 0.5, -d/2 + 1.5 + r * 3);
                    panel.rotation.x = -0.3;
                    group.add(panel);
                }
            }
            group.position.set(x, y, z);
            group.userData = { name, labelOffset: 3, labelType: 'solar' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        function createGroundPV(x, z, name) {
            const group = new THREE.Group();
            const pvMat = new THREE.MeshStandardMaterial({ color: 0x1a237e, metalness: 0.6 });
            for(let r = 0; r < 4; r++) {
                for(let c = 0; c < 8; c++) {
                    const panel = new THREE.Mesh(new THREE.BoxGeometry(3.5, 0.06, 1.8), pvMat);
                    panel.position.set(c * 4.5, 2, r * 3);
                    panel.rotation.x = -0.35;
                    group.add(panel);
                    const pole = new THREE.Mesh(new THREE.CylinderGeometry(0.08, 0.08, 2, 8), new THREE.MeshStandardMaterial({ color: 0x9e9e9e }));
                    pole.position.set(c * 4.5, 1, r * 3);
                    group.add(pole);
                }
            }
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 4, labelType: 'solar' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        function createWindTurbine(x, z, name) {
            const group = new THREE.Group();
            const tower = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 1.6, 40, 16), new THREE.MeshStandardMaterial({ color: 0xffffff }));
            tower.position.y = 20;
            group.add(tower);
            const nacelle = new THREE.Mesh(new THREE.BoxGeometry(3.5, 2.5, 5), new THREE.MeshStandardMaterial({ color: 0xf5f5f5 }));
            nacelle.position.set(0, 41, 0);
            group.add(nacelle);
            const blades = new THREE.Group();
            for(let i = 0; i < 3; i++) {
                const blade = new THREE.Mesh(new THREE.BoxGeometry(0.7, 16, 1.8), new THREE.MeshStandardMaterial({ color: 0xffffff }));
                blade.position.y = 8;
                const bg = new THREE.Group();
                bg.add(blade);
                bg.rotation.z = (i * Math.PI * 2) / 3;
                blades.add(bg);
            }
            blades.position.set(0, 41, 3.5);
            group.add(blades);
            windBlades.push(blades);
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 50, labelType: 'wind' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        function createStorage(x, z, name) {
            const group = new THREE.Group();
            for(let i = 0; i < 3; i++) {
                const container = new THREE.Mesh(new THREE.BoxGeometry(9, 3, 2.8), new THREE.MeshStandardMaterial({ color: 0x1565c0 }));
                container.position.set(i * 11, 1.5, 0);
                group.add(container);
            }
            const pcs = new THREE.Mesh(new THREE.BoxGeometry(3.5, 2.2, 1.8), new THREE.MeshStandardMaterial({ color: 0x37474f }));
            pcs.position.set(33, 1.1, 0);
            group.add(pcs);
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 5, labelType: 'battery' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        function createSubstation(x, z, name) {
            const group = new THREE.Group();
            const transformer = new THREE.Mesh(new THREE.BoxGeometry(4.5, 3.5, 3.5), new THREE.MeshStandardMaterial({ color: 0x78909c }));
            transformer.position.y = 1.75;
            group.add(transformer);
            for(let i = 0; i < 3; i++) {
                const insulator = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.25, 2.5, 8), new THREE.MeshStandardMaterial({ color: 0x8d6e63 }));
                insulator.position.set(-1.2 + i * 1.2, 4.75, 0);
                group.add(insulator);
            }
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 7, labelType: '' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        function createTree(x, z) {
            const group = new THREE.Group();
            group.add(new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.4, 3.5, 8), new THREE.MeshStandardMaterial({ color: 0x5d4037 })));
            const leaves = new THREE.Mesh(new THREE.SphereGeometry(2.5, 8, 8), new THREE.MeshStandardMaterial({ color: 0x388e3c }));
            leaves.position.y = 3.5;
            group.add(leaves);
            group.position.set(x, 1.75, z);
            group.scale.setScalar(0.7 + Math.random() * 0.4);
            scene.add(group);
        }
        
        function createEVScene() {
            const ground = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshStandardMaterial({ color: 0x7cb342 }));
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);
            
            const parking = new THREE.Mesh(new THREE.PlaneGeometry(90, 55), new THREE.MeshStandardMaterial({ color: 0x424242 }));
            parking.rotation.x = -Math.PI / 2;
            parking.position.y = 0.05;
            scene.add(parking);
            
            // å…‰ä¼è½¦æ£š
            createCarport(-28, -12, 'å…‰ä¼è½¦æ£šA');
            createCarport(-28, 12, 'å…‰ä¼è½¦æ£šB');
            createCarport(18, -12, 'å…‰ä¼è½¦æ£šC');
            createCarport(18, 12, 'å…‰ä¼è½¦æ£šD');
            
            // å……ç”µæ¡©
            const pilePos = [[-38,-18],[-30,-18],[-22,-18],[-14,-18],[-38,-6],[-30,-6],[-22,-6],[-14,-6],[10,-18],[18,-18],[26,-18],[34,-18],[10,-6],[18,-6],[26,-6],[34,-6]];
            pilePos.forEach((p, i) => createChargingPile(p[0], p[1], i < 4 || (i >= 8 && i < 12)));
            
            // ç”µåŠ¨æ±½è½¦
            [[-38,-18],[-30,-18],[-14,-18],[-38,-6],[-22,-6],[10,-18],[26,-18],[18,-6]].forEach(p => createEV(p[0] + 2, p[1] + 4.5));
            
            // å‚¨èƒ½
            const storageGroup = new THREE.Group();
            for(let i = 0; i < 2; i++) {
                const cab = new THREE.Mesh(new THREE.BoxGeometry(2.8, 2.2, 1.3), new THREE.MeshStandardMaterial({ color: 0x1565c0 }));
                cab.position.set(i * 3.5, 1.1, 0);
                storageGroup.add(cab);
            }
            storageGroup.position.set(52, 0, 0);
            storageGroup.userData = { name: 'å‚¨èƒ½æŸœ', labelOffset: 4, labelType: 'battery' };
            scene.add(storageGroup);
            sceneObjects.push(storageGroup);
            
            // V2Gæ ‡è¯†
            createV2GSign(-26, 0, 'V2Gæ ‡è¯†A');
            createV2GSign(22, 0, 'V2Gæ ‡è¯†B');
            
            // æœåŠ¡ä¸­å¿ƒ
            createBuilding(52, -25, 14, 5, 9, 0xffffff, 'æœåŠ¡ä¸­å¿ƒ');
            
            for(let i = 0; i < 15; i++) {
                const x = (Math.random() - 0.5) * 180;
                const z = (Math.random() - 0.5) * 180;
                if(Math.abs(x) > 50 || Math.abs(z) > 32) createTree(x, z);
            }
        }
        
        function createCarport(x, z, name) {
            const group = new THREE.Group();
            const poleMat = new THREE.MeshStandardMaterial({ color: 0x9e9e9e });
            [[0, 0], [0, 10], [22, 0], [22, 10]].forEach(p => {
                const pole = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.15, 4.5, 8), poleMat);
                pole.position.set(p[0] - 11, 2.25, p[1] - 5);
                group.add(pole);
            });
            const frame = new THREE.Mesh(new THREE.BoxGeometry(24, 0.25, 12), new THREE.MeshStandardMaterial({ color: 0xbdbdbd }));
            frame.position.y = 4.5;
            group.add(frame);
            const pvMat = new THREE.MeshStandardMaterial({ color: 0x1a237e, metalness: 0.6 });
            for(let r = 0; r < 3; r++) {
                for(let c = 0; c < 5; c++) {
                    const panel = new THREE.Mesh(new THREE.BoxGeometry(4.2, 0.06, 3.2), pvMat);
                    panel.position.set(-9 + c * 4.5, 4.7, -3.5 + r * 3.5);
                    panel.rotation.x = -0.12;
                    group.add(panel);
                }
            }
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 6, labelType: 'solar' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        function createChargingPile(x, z, isV2G) {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.7, 1.4, 0.4), new THREE.MeshStandardMaterial({ color: isV2G ? 0xff6b00 : 0x00a854 }));
            body.position.y = 0.7;
            group.add(body);
            const screen = new THREE.Mesh(new THREE.PlaneGeometry(0.4, 0.35), new THREE.MeshBasicMaterial({ color: 0x4fc3f7 }));
            screen.position.set(0, 1.05, 0.21);
            group.add(screen);
            group.position.set(x, 0, z);
            scene.add(group);
        }
        
        function createEV(x, z) {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(3.5, 1, 1.6), new THREE.MeshStandardMaterial({ color: Math.random() > 0.5 ? 0x1976d2 : 0xf5f5f5 }));
            body.position.y = 0.7;
            group.add(body);
            const roof = new THREE.Mesh(new THREE.BoxGeometry(2.2, 0.7, 1.4), new THREE.MeshStandardMaterial({ color: 0x333333 }));
            roof.position.set(0, 1.35, 0);
            group.add(roof);
            group.position.set(x, 0, z);
            group.rotation.y = Math.PI / 2;
            scene.add(group);
        }
        
        function createV2GSign(x, z, name) {
            const group = new THREE.Group();
            const pole = new THREE.Mesh(new THREE.CylinderGeometry(0.08, 0.08, 2.8, 8), new THREE.MeshStandardMaterial({ color: 0x9e9e9e }));
            pole.position.y = 1.4;
            group.add(pole);
            const sign = new THREE.Mesh(new THREE.BoxGeometry(1.8, 0.7, 0.08), new THREE.MeshStandardMaterial({ color: 0xff6b00 }));
            sign.position.y = 3;
            group.add(sign);
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 4.5, labelType: 'ev' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        function createC3Scene() {
            // ===== å®ä¼Ÿæ——èˆ°åº—è®¾è®¡ - Cocoa Tea Gold é…è‰²æ–¹æ¡ˆ =====
            // é…è‰²å®šä¹‰
            const COCOA_TEA_GOLD = 0xc9a86c;      // å¯å¯èŒ¶é‡‘
            const WARM_WHITE = 0xfaf8f5;          // æš–ç™½è‰²
            const VENETIAN_PLASTER = 0xf5f0e8;    // å¨å°¼æ–¯çŸ³è†è‰²
            const NATURAL_WOOD = 0xd4a574;        // å¤©ç„¶æœ¨æè‰²
            const DARK_WOOD = 0x8b6914;           // æ·±æœ¨è‰²
            const GLASS_TINT = 0xe8f4f8;          // ç»ç’ƒè‰²è°ƒ
            const SOFT_GOLD = 0xe8d5a3;           // æŸ”å’Œé‡‘è‰²
            const GREEN_WALL = 0x2d5a27;          // ç»¿æ¤å¢™è‰²
            
            // æ‰©å¤§åœºæ™¯å°ºå¯¸ - åˆ›é€ å®ä¼Ÿç©ºé—´æ„Ÿ
            const STORE_WIDTH = 160;
            const STORE_DEPTH = 120;
            const STORE_HEIGHT = 18;
            
            // ===== åœ°é¢ - é«˜å…‰ç±³è‰²å¤§ç†çŸ³çº¹ç† =====
            const floorMat = new THREE.MeshStandardMaterial({ 
                color: 0xf8f4ef, 
                roughness: 0.15,
                metalness: 0.05
            });
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(STORE_WIDTH, STORE_DEPTH), floorMat);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // å¤§ç†çŸ³çº¹ç†çº¿ - å®½é—´è·ä¼˜é›…çº¿æ¡
            const marbleLineMat = new THREE.MeshStandardMaterial({ color: SOFT_GOLD, metalness: 0.3 });
            for(let i = -55; i <= 55; i += 12) {
                const lineH = new THREE.Mesh(new THREE.PlaneGeometry(STORE_WIDTH, 0.08), marbleLineMat);
                lineH.rotation.x = -Math.PI / 2;
                lineH.position.set(0, 0.02, i);
                scene.add(lineH);
            }
            for(let i = -75; i <= 75; i += 12) {
                const lineV = new THREE.Mesh(new THREE.PlaneGeometry(0.08, STORE_DEPTH), marbleLineMat);
                lineV.rotation.x = -Math.PI / 2;
                lineV.position.set(i, 0.02, 0);
                scene.add(lineV);
            }
            
            // ===== åå¢™ - å¨å°¼æ–¯çŸ³è†è´¨æ„Ÿ + GRGè‰ºæœ¯å¢™ =====
            const venetianMat = new THREE.MeshStandardMaterial({ 
                color: VENETIAN_PLASTER, 
                roughness: 0.6,
                metalness: 0.0
            });
            const backWall = new THREE.Mesh(new THREE.BoxGeometry(STORE_WIDTH, STORE_HEIGHT, 0.5), venetianMat);
            backWall.position.set(0, STORE_HEIGHT/2, -STORE_DEPTH/2);
            scene.add(backWall);
            
            // GRGè‰ºæœ¯è£…é¥°æ¿ - æ³¢æµªçº¹ç†
            const grgMat = new THREE.MeshStandardMaterial({ color: WARM_WHITE, roughness: 0.4 });
            for(let i = 0; i < 8; i++) {
                const grgPanel = new THREE.Mesh(new THREE.BoxGeometry(15, 10, 0.3), grgMat);
                grgPanel.position.set(-52.5 + i * 15, 8, -STORE_DEPTH/2 + 0.5);
                scene.add(grgPanel);
                // é‡‘è‰²è¾¹æ¡†
                const goldFrame = new THREE.Mesh(
                    new THREE.BoxGeometry(15.5, 0.15, 0.4), 
                    new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.8, roughness: 0.2 })
                );
                goldFrame.position.set(-52.5 + i * 15, 13.2, -STORE_DEPTH/2 + 0.5);
                scene.add(goldFrame);
            }
            
            // ===== ä¾§å¢™ - é«˜é€æ˜ç»ç’ƒå¹•å¢™ =====
            const glassMat = new THREE.MeshStandardMaterial({ 
                color: GLASS_TINT, 
                transparent: true, 
                opacity: 0.25,
                roughness: 0.0,
                metalness: 0.1
            });
            const glassFrameMat = new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9, roughness: 0.1 });
            
            // å·¦ä¾§ç»ç’ƒå¹•å¢™
            for(let i = 0; i < 6; i++) {
                const glassPane = new THREE.Mesh(new THREE.BoxGeometry(0.15, STORE_HEIGHT - 2, 18), glassMat);
                glassPane.position.set(-STORE_WIDTH/2, STORE_HEIGHT/2, -45 + i * 18);
                scene.add(glassPane);
                // é‡‘è‰²ç«–æ¡†
                const vFrame = new THREE.Mesh(new THREE.BoxGeometry(0.3, STORE_HEIGHT, 0.8), glassFrameMat);
                vFrame.position.set(-STORE_WIDTH/2, STORE_HEIGHT/2, -54 + i * 18);
                scene.add(vFrame);
            }
            // å³ä¾§ç»ç’ƒå¹•å¢™
            for(let i = 0; i < 6; i++) {
                const glassPane = new THREE.Mesh(new THREE.BoxGeometry(0.15, STORE_HEIGHT - 2, 18), glassMat);
                glassPane.position.set(STORE_WIDTH/2, STORE_HEIGHT/2, -45 + i * 18);
                scene.add(glassPane);
                const vFrame = new THREE.Mesh(new THREE.BoxGeometry(0.3, STORE_HEIGHT, 0.8), glassFrameMat);
                vFrame.position.set(STORE_WIDTH/2, STORE_HEIGHT/2, -54 + i * 18);
                scene.add(vFrame);
            }
            
            // ===== ç»¿è‰²æ¤ç‰©å¢™ =====
            createGreenWall(-STORE_WIDTH/2 + 1, 8, -30, 0.5, 12, 35);
            createGreenWall(STORE_WIDTH/2 - 1, 8, 20, 0.5, 10, 25);
            
            // ===== å¤©èŠ±æ¿ - è‰ºæœ¯è£…ç½® =====
            const ceilingMat = new THREE.MeshStandardMaterial({ color: WARM_WHITE, roughness: 0.3 });
            const ceiling = new THREE.Mesh(new THREE.PlaneGeometry(STORE_WIDTH, STORE_DEPTH), ceilingMat);
            ceiling.rotation.x = Math.PI / 2;
            ceiling.position.y = STORE_HEIGHT;
            scene.add(ceiling);
            
            // è‰ºæœ¯å¤©èŠ±æ¿è£…ç½® - æ‚¬æµ®é‡‘ç¯é˜µåˆ—
            createArtisticCeiling(0, STORE_HEIGHT - 1, 0);
            
            // ===== å“ç‰Œå±•ç¤ºå¢™ - Cocoa Tea Gold è£…é¥° =====
            const brandGoldStrip = new THREE.Mesh(
                new THREE.BoxGeometry(80, 1.2, 0.15), 
                new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.85, roughness: 0.15 })
            );
            brandGoldStrip.position.set(0, 14.5, -STORE_DEPTH/2 + 0.8);
            scene.add(brandGoldStrip);
            
            // è¶…å¤§æ›²é¢LEDå±•ç¤ºå±
            const mainScreenGroup = new THREE.Group();
            const screenFrame = new THREE.Mesh(
                new THREE.BoxGeometry(50, 11, 0.8), 
                new THREE.MeshStandardMaterial({ color: 0x1a1a1a, metalness: 0.9 })
            );
            screenFrame.position.set(0, 0, 0);
            mainScreenGroup.add(screenFrame);
            // å±å¹•å‘å…‰é¢
            const screenGlow = new THREE.Mesh(
                new THREE.PlaneGeometry(48, 9.5), 
                new THREE.MeshBasicMaterial({ color: 0x0a4a7a })
            );
            screenGlow.position.set(0, 0, 0.45);
            mainScreenGroup.add(screenGlow);
            // é‡‘è‰²è¾¹æ¡†
            const screenBorder = new THREE.Mesh(
                new THREE.BoxGeometry(52, 0.3, 0.9), 
                new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9 })
            );
            screenBorder.position.set(0, 5.8, 0);
            mainScreenGroup.add(screenBorder);
            const screenBorder2 = screenBorder.clone();
            screenBorder2.position.set(0, -5.8, 0);
            mainScreenGroup.add(screenBorder2);
            mainScreenGroup.position.set(0, 7, -STORE_DEPTH/2 + 1.5);
            mainScreenGroup.userData = { name: 'å“ç‰Œå±•ç¤ºå±', labelOffset: 12, labelType: 'c3' };
            scene.add(mainScreenGroup);
            sceneObjects.push(mainScreenGroup);
            
            // ===== æš–è‰²ç¯å¢ƒå…‰å¸¦ =====
            const warmLedMat = new THREE.MeshBasicMaterial({ color: 0xfff5e6 });
            // å¤©èŠ±æ¿è¾¹ç¼˜ç¯å¸¦
            for(let i = -70; i <= 70; i += 20) {
                const ledStrip = new THREE.Mesh(new THREE.BoxGeometry(18, 0.15, 1.5), warmLedMat);
                ledStrip.position.set(i, STORE_HEIGHT - 0.1, -STORE_DEPTH/2 + 8);
                scene.add(ledStrip);
            }
            // ä¾§é¢è£…é¥°ç¯å¸¦
            for(let z = -50; z <= 45; z += 15) {
                const sideLed = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.3, 12), warmLedMat);
                sideLed.position.set(-STORE_WIDTH/2 + 1, 15, z);
                scene.add(sideLed);
                const sideLed2 = sideLed.clone();
                sideLed2.position.set(STORE_WIDTH/2 - 1, 15, z);
                scene.add(sideLed2);
            }
            
            // ===== å±•ç¤ºåŒºåŸŸ - å¯¹ç§°å¸ƒå±€ =====
            // ä¸­å¤®æ‰‹æœºæ——èˆ°å±•ç¤ºå²›
            createFlagshipPhoneIsland(0, -30, 'æ‰‹æœºå±•ç¤ºåŒº');
            
            // å·¦ä¾§å¹³æ¿ä½“éªŒåŒº
            createPremiumTabletZone(-45, 5, 'å¹³æ¿å±•ç¤ºåŒº');
            
            // å³ä¾§ç¬”è®°æœ¬ä½“éªŒåŒº
            createPremiumLaptopZone(45, 5, 'ç¬”è®°æœ¬å±•ç¤ºåŒº');
            
            // ä¸­å¤®ç©¿æˆ´è®¾å¤‡å±•ç¤ºå°
            createLuxuryWatchDisplay(0, 15, 'æ™ºèƒ½ç©¿æˆ´åŒº');
            
            // æ™ºèƒ½å®¶å±…ä½“éªŒåŒº
            createSmartHomeExperience(-45, -30, 'æ™ºèƒ½å®¶å±…åŒº');
            
            // é…ä»¶å±•ç¤ºå¢™
            createPremiumAccessoryWall(STORE_WIDTH/2 - 3, 0, 'é…ä»¶å±•ç¤ºå¢™');
            
            // ===== åŸå¸‚å®¢å…æ¦‚å¿µ - ç¤¾äº¤ä¼‘æ¯åŒº =====
            createCityLivingRoom(45, 35, 'ä½“éªŒä¼‘æ¯åŒº');
            
            // æœåŠ¡ä¸­å¿ƒ
            createPremiumServiceDesk(-55, 45, 'æœåŠ¡å°');
            
            // ===== ç²¾å“å°„ç¯ç³»ç»Ÿ =====
            const spotlightMat = new THREE.MeshStandardMaterial({ color: 0x2a2a2a, metalness: 0.8 });
            for(let x = -60; x <= 60; x += 25) {
                for(let z = -45; z <= 40; z += 22) {
                    const spotGroup = new THREE.Group();
                    const spotBody = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.6, 0.6, 16), spotlightMat);
                    spotGroup.add(spotBody);
                    // é‡‘è‰²è£…é¥°ç¯
                    const goldRing = new THREE.Mesh(
                        new THREE.TorusGeometry(0.5, 0.08, 8, 24),
                        new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9 })
                    );
                    goldRing.rotation.x = Math.PI / 2;
                    goldRing.position.y = -0.2;
                    spotGroup.add(goldRing);
                    // ç¯å…‰æ•ˆæœ
                    const lightCone = new THREE.Mesh(
                        new THREE.ConeGeometry(0.3, 0.8, 16, 1, true),
                        new THREE.MeshBasicMaterial({ color: 0xfff8e7, transparent: true, opacity: 0.15 })
                    );
                    lightCone.position.y = -0.7;
                    lightCone.rotation.x = Math.PI;
                    spotGroup.add(lightCone);
                    spotGroup.position.set(x, STORE_HEIGHT - 0.4, z);
                    scene.add(spotGroup);
                }
            }
            
            // ===== å¤§å‹ç»¿æ¤è£…é¥° =====
            createLuxuryPlant(-70, 50, 2.5);
            createLuxuryPlant(70, 50, 2.5);
            createLuxuryPlant(-70, -50, 2.2);
            createLuxuryPlant(70, -50, 2.2);
            createLuxuryPlant(-35, 50, 1.8);
            createLuxuryPlant(35, 50, 1.8);
            createLuxuryPlant(0, 52, 3);
            
            // ===== é¡¾å®¢æ¨¡å‹ (ç®€åŒ–è¡¨ç¤º) =====
            createShopperFigure(-10, -28, Math.PI * 0.3);
            createShopperFigure(15, -32, -Math.PI * 0.2);
            createShopperFigure(-42, 8, Math.PI * 0.5);
            createShopperFigure(48, 3, -Math.PI * 0.4);
            createShopperFigure(40, 38, Math.PI * 0.1);
        }
        
        // ===== ç»¿è‰²æ¤ç‰©å¢™ =====
        function createGreenWall(x, y, z, width, height, length) {
            const group = new THREE.Group();
            const baseColor = 0x2d5a27;
            const leafColors = [0x228b22, 0x32cd32, 0x3cb371, 0x2e8b57, 0x006400];
            
            // èƒŒæ¿
            const backMat = new THREE.MeshStandardMaterial({ color: 0x1a3a1a, roughness: 0.8 });
            const back = new THREE.Mesh(new THREE.BoxGeometry(width, height, length), backMat);
            group.add(back);
            
            // æ¤ç‰©å¶ç‰‡ç°‡
            for(let ly = -height/2 + 1; ly < height/2 - 0.5; ly += 1.5) {
                for(let lz = -length/2 + 1; lz < length/2 - 0.5; lz += 1.8) {
                    const leafCluster = new THREE.Mesh(
                        new THREE.SphereGeometry(0.8 + Math.random() * 0.4, 6, 6),
                        new THREE.MeshStandardMaterial({ 
                            color: leafColors[Math.floor(Math.random() * leafColors.length)],
                            roughness: 0.7
                        })
                    );
                    leafCluster.position.set(width/2 + 0.3, ly + Math.random() * 0.3, lz + Math.random() * 0.5);
                    leafCluster.scale.set(1.2, 0.8, 1);
                    group.add(leafCluster);
                }
            }
            group.position.set(x, y, z);
            scene.add(group);
        }
        
        // ===== è‰ºæœ¯å¤©èŠ±æ¿è£…ç½® =====
        function createArtisticCeiling(x, y, z) {
            const group = new THREE.Group();
            const goldMat = new THREE.MeshStandardMaterial({ 
                color: 0xc9a86c, 
                metalness: 0.85, 
                roughness: 0.15 
            });
            
            // æ‚¬æµ®é‡‘ç¯é˜µåˆ—
            const ringPositions = [
                [0, 0, 3], [-15, -10, 2.5], [15, -10, 2.8], [-25, 5, 2.2],
                [25, 5, 2.6], [0, 15, 2.4], [-35, -20, 2], [35, -20, 2.3],
                [-10, 25, 2.1], [10, 25, 2.7], [-45, 10, 1.8], [45, 10, 2]
            ];
            
            ringPositions.forEach(([rx, rz, size]) => {
                const ring = new THREE.Mesh(
                    new THREE.TorusGeometry(size, 0.12, 16, 48),
                    goldMat
                );
                ring.rotation.x = Math.PI / 2;
                ring.position.set(rx, -Math.random() * 2 - 1, rz);
                group.add(ring);
                
                // ç»†çº¿æ‚¬æŒ‚
                const wire = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.02, 0.02, Math.random() * 1.5 + 1, 8),
                    new THREE.MeshStandardMaterial({ color: 0xc0c0c0, metalness: 0.9 })
                );
                wire.position.set(rx, -0.5, rz);
                group.add(wire);
            });
            
            // ä¸­å¤®å¤§å‹è‰ºæœ¯è£…ç½®
            const centerRing = new THREE.Mesh(
                new THREE.TorusGeometry(5, 0.2, 24, 64),
                goldMat
            );
            centerRing.rotation.x = Math.PI / 2;
            centerRing.position.set(0, -2.5, -15);
            group.add(centerRing);
            
            group.position.set(x, y, z);
            scene.add(group);
        }
        
        // ===== æ——èˆ°æ‰‹æœºå±•ç¤ºå²› =====
        function createFlagshipPhoneIsland(x, z, name) {
            const group = new THREE.Group();
            const COCOA_TEA_GOLD = 0xc9a86c;
            const NATURAL_WOOD = 0xd4a574;
            
            // æ¤­åœ†å½¢å±•ç¤ºå²›åŸºåº§
            const islandBase = new THREE.Mesh(
                new THREE.CylinderGeometry(18, 19, 0.4, 48),
                new THREE.MeshStandardMaterial({ color: NATURAL_WOOD, roughness: 0.35, metalness: 0.05 })
            );
            islandBase.position.y = 0.2;
            group.add(islandBase);
            
            // é‡‘è‰²è£…é¥°è¾¹
            const goldEdge = new THREE.Mesh(
                new THREE.TorusGeometry(18.5, 0.15, 16, 64),
                new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9, roughness: 0.1 })
            );
            goldEdge.rotation.x = Math.PI / 2;
            goldEdge.position.y = 0.4;
            group.add(goldEdge);
            
            // ä¸»å±•ç¤ºå°é¢
            const mainTable = new THREE.Mesh(
                new THREE.CylinderGeometry(16, 16, 0.9, 48),
                new THREE.MeshStandardMaterial({ color: 0xfaf8f5, roughness: 0.2, metalness: 0.02 })
            );
            mainTable.position.y = 0.85;
            group.add(mainTable);
            
            // æ‰‹æœºå±•ç¤º
            const phoneMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a, metalness: 0.95, roughness: 0.1 });
            for(let i = 0; i < 8; i++) {
                const angle = (i * Math.PI * 2) / 8;
                const radius = 11;
                const phoneGroup = new THREE.Group();
                
                // äºšå…‹åŠ›å±•ç¤ºæ”¯æ¶
                const standBase = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.6, 0.7, 0.15, 24),
                    new THREE.MeshStandardMaterial({ color: 0xffffff, transparent: true, opacity: 0.9, roughness: 0.1 })
                );
                standBase.position.y = 0.075;
                phoneGroup.add(standBase);
                
                const standPole = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.08, 0.1, 0.8, 16),
                    new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9 })
                );
                standPole.position.y = 0.55;
                phoneGroup.add(standPole);
                
                // æ‰‹æœºæœ¬ä½“
                const phone = new THREE.Mesh(new THREE.BoxGeometry(0.8, 1.7, 0.09), phoneMat);
                phone.position.y = 1.5;
                phone.rotation.x = -0.12;
                phoneGroup.add(phone);
                
                // æ‰‹æœºå±å¹•
                const screenColor = c3Devices.phones[i].battery < 20 ? 0xff4444 : 0x1a73e8;
                const screen = new THREE.Mesh(
                    new THREE.PlaneGeometry(0.72, 1.55), 
                    new THREE.MeshBasicMaterial({ color: screenColor })
                );
                screen.position.set(0, 1.5, 0.05);
                screen.rotation.x = -0.12;
                phoneGroup.add(screen);
                
                phoneGroup.position.set(Math.cos(angle) * radius, 1.3, Math.sin(angle) * radius);
                phoneGroup.rotation.y = -angle + Math.PI / 2;
                group.add(phoneGroup);
            }
            
            // ä¸­å¤®å“ç‰Œç«‹æŸ±
            const centerPillar = new THREE.Mesh(
                new THREE.CylinderGeometry(1.2, 1.5, 3, 32),
                new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.85, roughness: 0.15 })
            );
            centerPillar.position.y = 2.8;
            group.add(centerPillar);
            
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 5, labelType: 'c3' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        // ===== é«˜ç«¯å¹³æ¿å±•ç¤ºåŒº =====
        function createPremiumTabletZone(x, z, name) {
            const group = new THREE.Group();
            const COCOA_TEA_GOLD = 0xc9a86c;
            const NATURAL_WOOD = 0xd4a574;
            
            // Lå‹å±•ç¤ºå°
            const tableMat = new THREE.MeshStandardMaterial({ color: NATURAL_WOOD, roughness: 0.35 });
            const table1 = new THREE.Mesh(new THREE.BoxGeometry(20, 0.9, 8), tableMat);
            table1.position.set(0, 0.45, 0);
            group.add(table1);
            const table2 = new THREE.Mesh(new THREE.BoxGeometry(8, 0.9, 15), tableMat);
            table2.position.set(-6, 0.45, 11.5);
            group.add(table2);
            
            // é‡‘è‰²è£…é¥°æ¡
            const goldStrip = new THREE.Mesh(
                new THREE.BoxGeometry(20.5, 0.12, 0.12),
                new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9 })
            );
            goldStrip.position.set(0, 0.96, -3.9);
            group.add(goldStrip);
            
            // å¹³æ¿å±•ç¤º
            const tabletMat = new THREE.MeshStandardMaterial({ color: 0x2d2d2d, metalness: 0.8 });
            for(let i = 0; i < 6; i++) {
                const tabletGroup = new THREE.Group();
                
                // æ”¯æ¶
                const stand = new THREE.Mesh(
                    new THREE.BoxGeometry(0.4, 1.4, 1),
                    new THREE.MeshStandardMaterial({ color: 0xf0f0f0, metalness: 0.3 })
                );
                stand.position.y = 0.7;
                tabletGroup.add(stand);
                
                // å¹³æ¿
                const tablet = new THREE.Mesh(new THREE.BoxGeometry(2, 2.8, 0.07), tabletMat);
                tablet.position.y = 1.8;
                tablet.rotation.x = -0.18;
                tabletGroup.add(tablet);
                
                // å±å¹•
                const screenColor = c3Devices.tablets[i].battery < 20 ? 0xff4444 : 0x4fc3f7;
                const screen = new THREE.Mesh(
                    new THREE.PlaneGeometry(1.85, 2.6),
                    new THREE.MeshBasicMaterial({ color: screenColor })
                );
                screen.position.set(0, 1.8, 0.04);
                screen.rotation.x = -0.18;
                tabletGroup.add(screen);
                
                if(i < 4) {
                    tabletGroup.position.set(-8 + i * 5.5, 0.9, 0);
                } else {
                    tabletGroup.position.set(-6, 0.9, 6 + (i - 4) * 6);
                    tabletGroup.rotation.y = Math.PI / 2;
                }
                group.add(tabletGroup);
            }
            
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 4.5, labelType: 'c3' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        // ===== é«˜ç«¯ç¬”è®°æœ¬å±•ç¤ºåŒº =====
        function createPremiumLaptopZone(x, z, name) {
            const group = new THREE.Group();
            const COCOA_TEA_GOLD = 0xc9a86c;
            const NATURAL_WOOD = 0xd4a574;
            
            // é˜¶æ¢¯å¼å±•ç¤ºå°
            for(let i = 0; i < 3; i++) {
                const stepTable = new THREE.Mesh(
                    new THREE.BoxGeometry(22, 0.8 + i * 0.25, 6),
                    new THREE.MeshStandardMaterial({ color: NATURAL_WOOD, roughness: 0.35 })
                );
                stepTable.position.set(0, 0.4 + i * 0.3, i * 7);
                group.add(stepTable);
                
                // é‡‘è‰²ä¾§è¾¹
                const goldSide = new THREE.Mesh(
                    new THREE.BoxGeometry(0.1, 0.8 + i * 0.25, 6),
                    new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9 })
                );
                goldSide.position.set(11, 0.4 + i * 0.3, i * 7);
                group.add(goldSide);
            }
            
            // ç¬”è®°æœ¬å±•ç¤º
            const laptopMat = new THREE.MeshStandardMaterial({ color: 0x505050, metalness: 0.85 });
            for(let i = 0; i < 5; i++) {
                const laptopGroup = new THREE.Group();
                const row = Math.floor(i / 2);
                const col = i % 2;
                
                // åº•åº§
                const base = new THREE.Mesh(new THREE.BoxGeometry(3.2, 0.12, 2.2), laptopMat);
                laptopGroup.add(base);
                
                // å±å¹•
                const screenPart = new THREE.Mesh(new THREE.BoxGeometry(3.2, 2.2, 0.1), laptopMat);
                screenPart.position.set(0, 1.1, -1);
                screenPart.rotation.x = -0.12;
                laptopGroup.add(screenPart);
                
                const screenColor = c3Devices.laptops[i].battery < 20 ? 0xff4444 : 0x1a73e8;
                const screen = new THREE.Mesh(
                    new THREE.PlaneGeometry(3, 2),
                    new THREE.MeshBasicMaterial({ color: screenColor })
                );
                screen.position.set(0, 1.1, -0.94);
                screen.rotation.x = -0.12;
                laptopGroup.add(screen);
                
                // é”®ç›˜
                const keyboard = new THREE.Mesh(
                    new THREE.PlaneGeometry(2.8, 1.5),
                    new THREE.MeshStandardMaterial({ color: 0x1a1a1a })
                );
                keyboard.rotation.x = -Math.PI / 2;
                keyboard.position.set(0, 0.07, 0.2);
                laptopGroup.add(keyboard);
                
                if(i < 4) {
                    laptopGroup.position.set(-5 + col * 10, 0.8 + row * 0.3 + 0.1, row * 7);
                } else {
                    laptopGroup.position.set(0, 1.4, 14);
                }
                group.add(laptopGroup);
            }
            
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 4.5, labelType: 'c3' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        // ===== å¥¢åæ‰‹è¡¨å±•ç¤ºåŒº =====
        function createLuxuryWatchDisplay(x, z, name) {
            const group = new THREE.Group();
            const COCOA_TEA_GOLD = 0xc9a86c;
            
            // åœ†å½¢ç»ç’ƒå±•ç¤ºæŸœ
            const displayCase = new THREE.Mesh(
                new THREE.CylinderGeometry(8, 8, 0.15, 48),
                new THREE.MeshStandardMaterial({ color: 0xfaf8f5, roughness: 0.15 })
            );
            displayCase.position.y = 1.2;
            group.add(displayCase);
            
            // é‡‘è‰²åº•åº§
            const goldBase = new THREE.Mesh(
                new THREE.CylinderGeometry(8.3, 8.5, 1.1, 48),
                new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.85, roughness: 0.15 })
            );
            goldBase.position.y = 0.55;
            group.add(goldBase);
            
            // ä¸­å¤®å±•ç¤ºæŸ±
            const centerDisplay = new THREE.Mesh(
                new THREE.CylinderGeometry(1.5, 1.8, 2.5, 32),
                new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.2 })
            );
            centerDisplay.position.y = 2.5;
            group.add(centerDisplay);
            
            // æ‰‹è¡¨å±•ç¤º
            const watchMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a, metalness: 0.98 });
            for(let i = 0; i < 5; i++) {
                const angle = (i * Math.PI * 2) / 5 - Math.PI / 2;
                const radius = 5;
                const watchGroup = new THREE.Group();
                
                // å±•ç¤ºå°
                const watchStand = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.7, 0.85, 0.6, 24),
                    new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.15 })
                );
                watchStand.position.y = 0.3;
                watchGroup.add(watchStand);
                
                // é‡‘è‰²ç¯
                const goldRing = new THREE.Mesh(
                    new THREE.TorusGeometry(0.75, 0.05, 12, 32),
                    new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.95 })
                );
                goldRing.rotation.x = Math.PI / 2;
                goldRing.position.y = 0.6;
                watchGroup.add(goldRing);
                
                // æ‰‹è¡¨
                const watch = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.5, 0.5, 0.14, 32),
                    watchMat
                );
                watch.position.y = 0.85;
                watch.rotation.x = Math.PI / 5;
                watchGroup.add(watch);
                
                // è¡¨ç›˜
                const dialColor = c3Devices.watches[i].battery < 30 ? 0xffa726 : 0x66bb6a;
                const dial = new THREE.Mesh(
                    new THREE.CircleGeometry(0.42, 32),
                    new THREE.MeshBasicMaterial({ color: dialColor })
                );
                dial.position.set(0, 0.88, 0.06);
                dial.rotation.x = Math.PI / 5;
                watchGroup.add(dial);
                
                // è¡¨å¸¦
                const strap = new THREE.Mesh(
                    new THREE.BoxGeometry(0.38, 0.1, 1.4),
                    new THREE.MeshStandardMaterial({ color: 0x2d2d2d })
                );
                strap.position.y = 0.85;
                strap.rotation.x = Math.PI / 5;
                watchGroup.add(strap);
                
                watchGroup.position.set(Math.cos(angle) * radius, 1.3, Math.sin(angle) * radius);
                watchGroup.rotation.y = -angle;
                group.add(watchGroup);
            }
            
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 5, labelType: 'c3' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        // ===== æ™ºèƒ½å®¶å±…ä½“éªŒåŒº =====
        function createSmartHomeExperience(x, z, name) {
            const group = new THREE.Group();
            const COCOA_TEA_GOLD = 0xc9a86c;
            const NATURAL_WOOD = 0xd4a574;
            
            // å±•ç¤ºå¹³å°
            const platform = new THREE.Mesh(
                new THREE.BoxGeometry(18, 0.3, 14),
                new THREE.MeshStandardMaterial({ color: NATURAL_WOOD, roughness: 0.3 })
            );
            platform.position.y = 0.15;
            group.add(platform);
            
            // é‡‘è‰²è¾¹æ¡†
            const borderMat = new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9 });
            const border1 = new THREE.Mesh(new THREE.BoxGeometry(18.3, 0.1, 0.15), borderMat);
            border1.position.set(0, 0.35, -6.9);
            group.add(border1);
            const border2 = border1.clone();
            border2.position.set(0, 0.35, 6.9);
            group.add(border2);
            
            // å±•ç¤ºæ¡Œ
            const tableMat = new THREE.MeshStandardMaterial({ color: 0xfaf8f5, roughness: 0.2 });
            const displayTable = new THREE.Mesh(new THREE.BoxGeometry(14, 0.8, 10), tableMat);
            displayTable.position.y = 0.7;
            group.add(displayTable);
            
            // æ™ºèƒ½éŸ³ç®±
            const speaker = new THREE.Mesh(
                new THREE.CylinderGeometry(0.8, 1, 2, 24),
                new THREE.MeshStandardMaterial({ color: 0x2d2d2d, metalness: 0.5 })
            );
            speaker.position.set(-4, 2.1, 0);
            group.add(speaker);
            // éŸ³ç®±ç¯ç¯
            const speakerRing = new THREE.Mesh(
                new THREE.TorusGeometry(0.85, 0.08, 12, 32),
                new THREE.MeshBasicMaterial({ color: 0x4fc3f7 })
            );
            speakerRing.rotation.x = Math.PI / 2;
            speakerRing.position.set(-4, 3.15, 0);
            group.add(speakerRing);
            
            // æ™ºèƒ½å°ç¯
            const lampBase = new THREE.Mesh(
                new THREE.CylinderGeometry(0.6, 0.7, 0.3, 24),
                new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.85 })
            );
            lampBase.position.set(0, 1.25, 0);
            group.add(lampBase);
            const lampPole = new THREE.Mesh(
                new THREE.CylinderGeometry(0.1, 0.1, 2.5, 16),
                new THREE.MeshStandardMaterial({ color: 0xc0c0c0, metalness: 0.9 })
            );
            lampPole.position.set(0, 2.65, 0);
            group.add(lampPole);
            const lampHead = new THREE.Mesh(
                new THREE.CylinderGeometry(1, 0.5, 0.4, 24),
                new THREE.MeshStandardMaterial({ color: 0xffffff })
            );
            lampHead.position.set(0, 4, 0);
            group.add(lampHead);
            // ç¯å…‰
            const lampLight = new THREE.Mesh(
                new THREE.CircleGeometry(0.9, 24),
                new THREE.MeshBasicMaterial({ color: 0xfff5e6 })
            );
            lampLight.rotation.x = Math.PI / 2;
            lampLight.position.set(0, 3.78, 0);
            group.add(lampLight);
            
            // è·¯ç”±å™¨
            const router = new THREE.Mesh(
                new THREE.BoxGeometry(1.5, 0.25, 1),
                new THREE.MeshStandardMaterial({ color: 0xffffff, metalness: 0.3 })
            );
            router.position.set(4, 1.22, 0);
            group.add(router);
            // å¤©çº¿
            for(let i = -1; i <= 1; i++) {
                const antenna = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.04, 0.04, 1.2, 8),
                    new THREE.MeshStandardMaterial({ color: 0x333333 })
                );
                antenna.position.set(4 + i * 0.4, 1.95, 0);
                antenna.rotation.z = i * 0.15;
                group.add(antenna);
            }
            
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 5.5, labelType: 'c3' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        // ===== é«˜ç«¯é…ä»¶å¢™ =====
        function createPremiumAccessoryWall(x, z, name) {
            const group = new THREE.Group();
            const COCOA_TEA_GOLD = 0xc9a86c;
            
            // èƒŒæ¿
            const backMat = new THREE.MeshStandardMaterial({ color: 0xfaf8f5, roughness: 0.3 });
            const backboard = new THREE.Mesh(new THREE.BoxGeometry(0.3, 12, 30), backMat);
            group.add(backboard);
            
            // é‡‘è‰²è£…é¥°æ¡†æ¶
            const frameMat = new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9 });
            const topFrame = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.2, 30.5), frameMat);
            topFrame.position.set(0, 6, 0);
            group.add(topFrame);
            const bottomFrame = topFrame.clone();
            bottomFrame.position.set(0, -6, 0);
            group.add(bottomFrame);
            
            // å±‚æ¶
            for(let i = 0; i < 4; i++) {
                const shelf = new THREE.Mesh(
                    new THREE.BoxGeometry(1.8, 0.12, 28),
                    new THREE.MeshStandardMaterial({ color: 0xf5f0e8, roughness: 0.2 })
                );
                shelf.position.set(1, -4.5 + i * 3, 0);
                group.add(shelf);
                
                // é‡‘è‰²æ”¯æ’‘
                for(let j = -12; j <= 12; j += 8) {
                    const support = new THREE.Mesh(
                        new THREE.BoxGeometry(0.08, 0.08, 0.5),
                        frameMat
                    );
                    support.position.set(0.3, -4.5 + i * 3 - 0.1, j);
                    group.add(support);
                }
                
                // é…ä»¶ç›’
                for(let j = 0; j < 7; j++) {
                    const boxColors = [0xffffff, 0x1a1a1a, 0xf5f5f5, 0x2d2d2d];
                    const box = new THREE.Mesh(
                        new THREE.BoxGeometry(1.2, 1.8, 3.5),
                        new THREE.MeshStandardMaterial({ 
                            color: boxColors[Math.floor(Math.random() * boxColors.length)],
                            roughness: 0.3
                        })
                    );
                    box.position.set(1, -3.5 + i * 3, -10.5 + j * 3.5);
                    group.add(box);
                }
            }
            
            group.position.set(x, 6, z);
            group.userData = { name, labelOffset: 8, labelType: 'c3' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        // ===== åŸå¸‚å®¢å…ä¼‘æ¯åŒº =====
        function createCityLivingRoom(x, z, name) {
            const group = new THREE.Group();
            const COCOA_TEA_GOLD = 0xc9a86c;
            const NATURAL_WOOD = 0xd4a574;
            
            // åœ°æ¯¯
            const carpet = new THREE.Mesh(
                new THREE.PlaneGeometry(18, 14),
                new THREE.MeshStandardMaterial({ color: 0xe8e0d5, roughness: 0.8 })
            );
            carpet.rotation.x = -Math.PI / 2;
            carpet.position.y = 0.02;
            group.add(carpet);
            
            // Lå‹æ²™å‘
            const sofaMat = new THREE.MeshStandardMaterial({ color: 0x4a4a4a, roughness: 0.6 });
            // ä¸»æ²™å‘
            const sofaMain = new THREE.Mesh(new THREE.BoxGeometry(10, 0.6, 3.5), sofaMat);
            sofaMain.position.set(0, 0.3, 4);
            group.add(sofaMain);
            const sofaBack = new THREE.Mesh(new THREE.BoxGeometry(10, 1.2, 0.6), sofaMat);
            sofaBack.position.set(0, 0.9, 5.45);
            group.add(sofaBack);
            // ä¾§æ²™å‘
            const sofaSide = new THREE.Mesh(new THREE.BoxGeometry(3.5, 0.6, 6), sofaMat);
            sofaSide.position.set(6.75, 0.3, 1.5);
            group.add(sofaSide);
            const sofaSideBack = new THREE.Mesh(new THREE.BoxGeometry(0.6, 1.2, 6), sofaMat);
            sofaSideBack.position.set(8.2, 0.9, 1.5);
            group.add(sofaSideBack);
            
            // åå«
            const cushionMat = new THREE.MeshStandardMaterial({ color: 0x5a5a5a, roughness: 0.5 });
            for(let i = 0; i < 3; i++) {
                const cushion = new THREE.Mesh(new THREE.BoxGeometry(2.8, 0.25, 2.8), cushionMat);
                cushion.position.set(-3.2 + i * 3.2, 0.72, 4);
                group.add(cushion);
            }
            
            // å’–å•¡æ¡Œ
            const coffeeTable = new THREE.Mesh(
                new THREE.CylinderGeometry(2.5, 2.5, 0.12, 32),
                new THREE.MeshStandardMaterial({ color: NATURAL_WOOD, roughness: 0.3 })
            );
            coffeeTable.position.set(0, 0.5, 0);
            group.add(coffeeTable);
            // é‡‘è‰²æ¡Œè…¿
            const legMat = new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9 });
            for(let i = 0; i < 3; i++) {
                const angle = (i * Math.PI * 2) / 3;
                const leg = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.12, 0.45, 16), legMat);
                leg.position.set(Math.cos(angle) * 1.8, 0.22, Math.sin(angle) * 1.8);
                group.add(leg);
            }
            
            // è£…é¥°å“
            const vaseMat = new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.7 });
            const vase = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.4, 0.8, 16), vaseMat);
            vase.position.set(-0.5, 0.96, 0);
            group.add(vase);
            // èŠ±
            const flower = new THREE.Mesh(
                new THREE.SphereGeometry(0.35, 8, 8),
                new THREE.MeshStandardMaterial({ color: 0x90ee90 })
            );
            flower.position.set(-0.5, 1.5, 0);
            group.add(flower);
            
            // è¾¹å‡ 
            const sideTable = new THREE.Mesh(
                new THREE.CylinderGeometry(0.5, 0.5, 0.6, 24),
                new THREE.MeshStandardMaterial({ color: 0xfaf8f5, roughness: 0.2 })
            );
            sideTable.position.set(-5.5, 0.3, 4);
            group.add(sideTable);
            
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 3.5, labelType: 'c3' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        // ===== é«˜ç«¯æœåŠ¡å° =====
        function createPremiumServiceDesk(x, z, name) {
            const group = new THREE.Group();
            const COCOA_TEA_GOLD = 0xc9a86c;
            
            // ä¸»æœåŠ¡å°
            const deskMat = new THREE.MeshStandardMaterial({ color: 0xfaf8f5, roughness: 0.2 });
            const desk = new THREE.Mesh(new THREE.BoxGeometry(10, 1.1, 3), deskMat);
            desk.position.y = 0.55;
            group.add(desk);
            
            // é‡‘è‰²é¡¶è¾¹
            const goldTop = new THREE.Mesh(
                new THREE.BoxGeometry(10.2, 0.08, 3.2),
                new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.9 })
            );
            goldTop.position.y = 1.14;
            group.add(goldTop);
            
            // å‰é¢æ¿è£…é¥°
            const frontPanel = new THREE.Mesh(
                new THREE.BoxGeometry(10, 0.9, 0.15),
                new THREE.MeshStandardMaterial({ color: 0xf5f0e8, roughness: 0.3 })
            );
            frontPanel.position.set(0, 0.55, -1.5);
            group.add(frontPanel);
            
            // é‡‘è‰²å“ç‰Œæ ‡è¯†
            const brandLogo = new THREE.Mesh(
                new THREE.BoxGeometry(3, 0.5, 0.1),
                new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.95 })
            );
            brandLogo.position.set(0, 0.55, -1.55);
            group.add(brandLogo);
            
            // ç”µè„‘æ˜¾ç¤ºå™¨
            const monitorGroup = new THREE.Group();
            const monitor = new THREE.Mesh(
                new THREE.BoxGeometry(2, 1.3, 0.1),
                new THREE.MeshStandardMaterial({ color: 0x1a1a1a, metalness: 0.9 })
            );
            monitor.position.y = 0.65;
            monitorGroup.add(monitor);
            const monitorScreen = new THREE.Mesh(
                new THREE.PlaneGeometry(1.85, 1.15),
                new THREE.MeshBasicMaterial({ color: 0x1a73e8 })
            );
            monitorScreen.position.set(0, 0.65, 0.06);
            monitorGroup.add(monitorScreen);
            const monitorStand = new THREE.Mesh(
                new THREE.CylinderGeometry(0.12, 0.18, 0.6, 16),
                new THREE.MeshStandardMaterial({ color: 0xc0c0c0, metalness: 0.9 })
            );
            monitorStand.position.y = -0.05;
            monitorGroup.add(monitorStand);
            monitorGroup.position.set(-2.5, 1.15, 0.5);
            group.add(monitorGroup);
            
            // ç¬¬äºŒå°æ˜¾ç¤ºå™¨
            const monitor2 = monitorGroup.clone();
            monitor2.position.set(2.5, 1.15, 0.5);
            group.add(monitor2);
            
            group.position.set(x, 0, z);
            group.userData = { name, labelOffset: 4, labelType: 'c3' };
            scene.add(group);
            sceneObjects.push(group);
        }
        
        // ===== è±ªåç»¿æ¤ =====
        function createLuxuryPlant(x, z, scale) {
            const group = new THREE.Group();
            const COCOA_TEA_GOLD = 0xc9a86c;
            
            // é‡‘è‰²èŠ±ç›†
            const potOuter = new THREE.Mesh(
                new THREE.CylinderGeometry(1.2, 0.9, 1.5, 24),
                new THREE.MeshStandardMaterial({ color: COCOA_TEA_GOLD, metalness: 0.7, roughness: 0.25 })
            );
            potOuter.position.y = 0.75;
            group.add(potOuter);
            
            // å†…ç›†
            const potInner = new THREE.Mesh(
                new THREE.CylinderGeometry(1, 0.7, 1.3, 24),
                new THREE.MeshStandardMaterial({ color: 0x3a2a1a })
            );
            potInner.position.y = 0.85;
            group.add(potInner);
            
            // æ¤ç‰©
            const plantColors = [0x228b22, 0x32cd32, 0x2e8b57];
            for(let i = 0; i < 5; i++) {
                const leaf = new THREE.Mesh(
                    new THREE.SphereGeometry(1.5 + Math.random() * 0.5, 8, 8),
                    new THREE.MeshStandardMaterial({ 
                        color: plantColors[Math.floor(Math.random() * plantColors.length)],
                        roughness: 0.6
                    })
                );
                const angle = (i * Math.PI * 2) / 5;
                leaf.position.set(
                    Math.cos(angle) * 0.5,
                    2.5 + Math.random() * 0.8,
                    Math.sin(angle) * 0.5
                );
                leaf.scale.set(1, 0.7, 1);
                group.add(leaf);
            }
            
            // é¡¶éƒ¨ä¸»å¶
            const topLeaf = new THREE.Mesh(
                new THREE.SphereGeometry(1.8, 8, 8),
                new THREE.MeshStandardMaterial({ color: 0x228b22, roughness: 0.6 })
            );
            topLeaf.position.y = 3.5;
            topLeaf.scale.set(1, 0.8, 1);
            group.add(topLeaf);
            
            group.position.set(x, 0, z);
            group.scale.setScalar(scale);
            scene.add(group);
        }
        
        // ===== é¡¾å®¢äººç‰©æ¨¡å‹ =====
        function createShopperFigure(x, z, rotation) {
            const group = new THREE.Group();
            
            // èº«ä½“
            const bodyMat = new THREE.MeshStandardMaterial({ color: 0x4a4a4a, roughness: 0.6 });
            const body = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.35, 1.2, 16), bodyMat);
            body.position.y = 1.1;
            group.add(body);
            
            // å¤´
            const head = new THREE.Mesh(
                new THREE.SphereGeometry(0.25, 16, 16),
                new THREE.MeshStandardMaterial({ color: 0xf5deb3, roughness: 0.5 })
            );
            head.position.y = 1.95;
            group.add(head);
            
            // å¤´å‘
            const hair = new THREE.Mesh(
                new THREE.SphereGeometry(0.27, 16, 8, 0, Math.PI * 2, 0, Math.PI / 2),
                new THREE.MeshStandardMaterial({ color: 0x2a1a0a })
            );
            hair.position.y = 2.02;
            group.add(hair);
            
            // è…¿
            const legMat = new THREE.MeshStandardMaterial({ color: 0x2d2d2d });
            const leg1 = new THREE.Mesh(new THREE.CylinderGeometry(0.12, 0.1, 0.9, 12), legMat);
            leg1.position.set(0.15, 0.45, 0);
            group.add(leg1);
            const leg2 = leg1.clone();
            leg2.position.set(-0.15, 0.45, 0);
            group.add(leg2);
            
            group.position.set(x, 0, z);
            group.rotation.y = rotation;
            scene.add(group);
        }
        
        
        function renderC3List(devices, id) {
            const container = document.getElementById(id);
            if(!container) return;
            container.innerHTML = devices.map(d => {
                const color = d.battery < 20 ? '#ff4d4f' : (d.battery < 50 ? '#faad14' : '#52c41a');
                return `<div class="c3-item">
                    <span class="c3-item-name">${d.name}</span>
                    <div class="c3-item-battery">
                        <span style="color:${color};font-weight:600">${d.battery}%</span>
                        <div class="c3-mini-bar"><div class="c3-mini-fill" style="width:${d.battery}%;background:${color}"></div></div>
                    </div>
                </div>`;
            }).join('');
        }
        
        let powerChart;
        function initCharts() {
            const ctx = document.getElementById('power-chart');
            if(ctx) {
                powerChart = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: { labels: [], datasets: [
                        { label: 'å…‰ä¼', data: [], borderColor: '#ff9500', backgroundColor: 'rgba(255,149,0,0.1)', fill: true, tension: 0.4, pointRadius: 0, borderWidth: 2 },
                        { label: 'è´Ÿè·', data: [], borderColor: '#ff6b6b', backgroundColor: 'rgba(255,107,107,0.1)', fill: true, tension: 0.4, pointRadius: 0, borderWidth: 2 }
                    ]},
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
                });
            }
        }
        
        function connectWS() {
            try {
                const ws = new WebSocket(`ws://${location.host}/api/ws/realtime`);
                ws.onmessage = (e) => {
                    const d = JSON.parse(e.data);
                    document.getElementById('pv-power').textContent = d.solar_power.toFixed(0) + ' kW';
                    document.getElementById('wind-power').textContent = d.wind_power.toFixed(0) + ' kW';
                    document.getElementById('load-power').textContent = d.load_power.toFixed(0) + ' kW';
                    document.getElementById('batt-power').textContent = Math.abs(d.battery_power).toFixed(0) + ' kW';
                    document.getElementById('batt-soc').textContent = (d.battery_soc * 100).toFixed(0) + '%';
                    document.getElementById('batt-bar').style.width = (d.battery_soc * 100) + '%';
                    document.getElementById('grid-power').textContent = d.grid_power.toFixed(0) + ' kW';
                    document.getElementById('stat-solar').textContent = Math.round(d.solar_power);
                    document.getElementById('stat-wind').textContent = Math.round(d.wind_power);
                    document.getElementById('stat-soc').textContent = Math.round(d.battery_soc * 100);
                    document.getElementById('stat-load').textContent = Math.round(d.load_power);
                    document.getElementById('stat-grid').textContent = Math.round(d.grid_power);
                    
                    // æ›´æ–°å¯¹è±¡æ•°æ®
                    objectData['å‚¨èƒ½ç”µç«™'].soc = Math.round(d.battery_soc * 100);
                    
                    if(powerChart) {
                        const now = new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
                        powerChart.data.labels.push(now);
                        powerChart.data.datasets[0].data.push(d.solar_power);
                        powerChart.data.datasets[1].data.push(d.load_power);
                        if(powerChart.data.labels.length > 15) {
                            powerChart.data.labels.shift();
                            powerChart.data.datasets.forEach(ds => ds.data.shift());
                        }
                        powerChart.update('none');
                    }
                };
                ws.onclose = () => setTimeout(connectWS, 3000);
            } catch(e) { setTimeout(connectWS, 3000); }
        }
        
        init3D();
        initCharts();
        connectWS();
        renderC3List(c3Devices.phones, 'phone-list');
        renderC3List(c3Devices.tablets, 'tablet-list');
        renderC3List(c3Devices.laptops, 'laptop-list');
        renderC3List(c3Devices.watches, 'watch-list');
    </script>
</body>
</html>
